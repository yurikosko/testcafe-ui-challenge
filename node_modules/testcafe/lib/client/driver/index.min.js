!function qa(Ya){var Ka=Ya.document;!function(c,e,y,_,n){var o="default"in c?c.default:c;e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var t="default"in y?y.default:y,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,s,a,c){return new(a=a||e)(function(n,e){function r(t){try{o(c.next(t))}catch(t){e(t)}}function i(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((c=c.apply(t,s||[])).next())})}function l(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var a,u,d=Math.floor(399);(u=a=a||{}).ready="ready",u.readyForBrowserManipulation="ready-for-browser-manipulation",u.waitForFileDownload="wait-for-file-download";var h=a,f={click:"click",rightClick:"right-click",doubleClick:"double-click",drag:"drag",dragToElement:"drag-to-element",hover:"hover",typeText:"type-text",selectText:"select-text",selectTextAreaContent:"select-text-area-content",selectEditableContent:"select-editable-content",pressKey:"press-key",wait:"wait",navigateTo:"navigate-to",setFilesToUpload:"set-files-to-upload",clearUpload:"clear-upload",executeClientFunction:"execute-client-function",executeSelector:"execute-selector",takeScreenshot:"take-screenshot",takeElementScreenshot:"take-element-screenshot",takeScreenshotOnFail:"take-screenshot-on-fail",prepareBrowserManipulation:"prepare-browser-manipulation",showAssertionRetriesStatus:"show-assertion-retries-status",hideAssertionRetriesStatus:"hide-assertion-retries-status",setBreakpoint:"set-breakpoint",resizeWindow:"resize-window",resizeWindowToFitDevice:"resize-window-to-fit-device",maximizeWindow:"maximize-window",switchToIframe:"switch-to-iframe",switchToMainWindow:"switch-to-main-window",openWindow:"open-window",closeWindow:"close-window",getCurrentWindow:"get-current-window",getCurrentWindows:"get-current-windows",switchToWindow:"switch-to-window",switchToWindowByPredicate:"switch-to-window-by-predicate",switchToParentWindow:"switch-to-parent-window",switchToPreviousWindow:"switch-to-previous-window",setNativeDialogHandler:"set-native-dialog-handler",getNativeDialogHistory:"get-native-dialog-history",getBrowserConsoleMessages:"get-browser-console-messages",setTestSpeed:"set-test-speed",setPageLoadTimeout:"set-page-load-timeout",debug:"debug",assertion:"assertion",useRole:"useRole",testDone:"test-done",backupStorages:"backup-storages",executeExpression:"execute-expression",executeAsyncExpression:"execute-async-expression",unlockPage:"unlock-page",recorder:"recorder"},p="E1",m="E4",g="E5",w="E9",v="E10",C="E11",I="E12",E="E24",S="E26",W="E27",T="E28",b="E29",x="E30",D="E31",A="E32",R="E33",P="E34",M="E35",N="E36",k="E37",L="E39",F="E40",O="E41",U="E42",G="E43",H="E44",B="E45",V="E46",z="E49",j="E50",X="E51",q="E52",Y="E57",K="E64",J="E65",$="E68",Q="E69",Z="E70",tt="E71",et="E72",nt="E73",rt="E74",it="E76",ot="E77",st="E78",at="E82",ct="E83";function lt(t){return!(function(t){return t.type===f.executeClientFunction||t.type===f.executeSelector}(r=t)||r.type===f.wait||r.type===f.assertion||r.type===f.executeExpression||dt(t)||(n=t).type===f.testDone||n.type===f.showAssertionRetriesStatus||n.type===f.hideAssertionRetriesStatus||n.type===f.setBreakpoint||n.type===f.takeScreenshotOnFail||n.type===f.recorder)||ut(t)&&!((e=t).type===f.switchToIframe||e.type===f.switchToMainWindow);var e,n,r}function ut(t){return t.type===f.resizeWindow||t.type===f.resizeWindowToFitDevice||t.type===f.maximizeWindow}function dt(t){return(e=t).type===f.takeScreenshot||e.type===f.takeElementScreenshot||e.type===f.takeScreenshotOnFail||ut(t);var e}function ht(t){this.code=t,this.isTestCafeError=!0,this.callsite=null}var ft,pt=(i(mt,ft=ht),mt);function mt(t,e,n){var r=ft.call(this,t)||this;return r.optionName=e,r.actualValue=n,r}var gt,wt=(i(vt,gt=ht),vt);function vt(t){var e=gt.call(this,z)||this;return e.instantiationCallsiteName=t,e}var yt,_t=(i(Ct,yt=ht),Ct);function Ct(t){var e=yt.call(this,j)||this;return e.instantiationCallsiteName=t,e}var It,Et=(i(St,It=ht),St);function St(t,e){var n=e.apiFnChain,r=e.apiFnIndex,i=It.call(this,t)||this;return i.apiFnChain=n,i.apiFnIndex=r,i}var Wt,Tt=(i(bt,Wt=ht),bt);function bt(){return Wt.call(this,X)||this}var xt,Dt=(i(At,xt=Et),At);function At(t,e){var n=xt.call(this,q,e)||this;return n.callsite=t,n}var Rt,Pt=(i(Mt,Rt=ht),Mt);function Mt(t,e){var n=Rt.call(this,p)||this;return n.errStack=t,n.pageDestUrl=e,n}var Nt,kt=(i(Lt,Nt=ht),Lt);function Lt(t,e){var n=Nt.call(this,m)||this;return n.errMsg=String(e),n.instantiationCallsiteName=t,n}var Ft,Ot=(i(Ut,Ft=ht),Ut);function Ut(t,e,n){var r=Ft.call(this,g,e,n)||this;return r.errMsg=String(e),r.property=n,r.instantiationCallsiteName=t,r}var Gt,Ht=(i(Bt,Gt=ht),Bt);function Bt(t){var e=Gt.call(this,K)||this;return e.errMsg=String(t),e}var Vt,zt=(i(jt,Vt=ht),jt);function jt(t,e){var n=Vt.call(this,J)||this;return n.errMsg=String(t),n.moduleName=e,n}var Xt,qt=(i(Yt,Xt=pt),Yt);function Yt(t,e){return Xt.call(this,w,t,e)||this}var Kt,Jt=(i($t,Kt=pt),$t);function $t(t,e){return Kt.call(this,v,t,e)||this}var Qt,Zt=(i(te,Qt=pt),te);function te(t,e){return Qt.call(this,C,t,e)||this}var ee,ne=(i(re,ee=pt),re);function re(t,e){return ee.call(this,I,t,e)||this}var ie,oe=(i(se,ie=Et),se);function se(t){return ie.call(this,E,t)||this}var ae,ce=(i(le,ae=ht),le);function le(){return ae.call(this,S)||this}var ue,de=(i(he,ue=ht),he);function he(t){var e=ue.call(this,W)||this;return e.nodeDescription=t,e}var fe,pe=(i(me,fe=Et),me);function me(t,e){var n=fe.call(this,T,e)||this;return n.argumentName=t,n}var ge,we=(i(ve,ge=ht),ve);function ve(t){var e=ge.call(this,b)||this;return e.argumentName=t,e}var ye,_e=(i(Ce,ye=ht),Ce);function Ce(t,e){var n=ye.call(this,x)||this;return n.argumentName=t,n.nodeDescription=e,n}var Ie,Ee=(i(Se,Ie=ht),Se);function Se(){return Ie.call(this,D)||this}var We,Te=(i(be,We=ht),be);function be(){return We.call(this,A)||this}var xe,De=(i(Ae,xe=ht),Ae);function Ae(t){var e=xe.call(this,R)||this;return e.argumentName=t,e}var Re,Pe=(i(Me,Re=ht),Me);function Me(){return Re.call(this,M)||this}var Ne,ke=(i(Le,Ne=ht),Le);function Le(t){var e=Ne.call(this,N)||this;return e.argumentName=t,e}var Fe,Oe=(i(Ue,Fe=ht),Ue);function Ue(t,e){var n=Fe.call(this,k)||this;return n.filePaths=t,n.scannedFilePaths=e,n}var Ge,He=(i(Be,Ge=ht),Be);function Be(){return Ge.call(this,P)||this}var Ve,ze=(i(je,Ve=ht),je);function je(t,e){var n=Ve.call(this,O)||this;return n.properties=t?"scrollTargetY property":e?"scrollTargetX property":"scrollTargetX and scrollTargetY properties",n}var Xe,qe=(i(Ye,Xe=ht),Ye);function Ye(t,e){var n=Xe.call(this,Y)||this;return t<=0?e<=0?(n.verb="are",n.dimensions="width and height"):(n.verb="is",n.dimensions="width"):(n.verb="is",n.dimensions="height"),n}var Ke,Je=(i($e,Ke=ht),$e);function $e(){return Ke.call(this,F)||this}var Qe,Ze=(i(tn,Qe=ht),tn);function tn(){return Qe.call(this,L)||this}var en,nn=(i(rn,en=ht),rn);function rn(){return en.call(this,U)||this}var on,sn=(i(an,on=ht),an);function an(){return on.call(this,Q)||this}var cn,ln=(i(un,cn=ht),un);function un(){return cn.call(this,$)||this}var dn,hn=(i(fn,dn=ht),fn);function fn(){return dn.call(this,Z)||this}var pn,mn=(i(gn,pn=ht),gn);function gn(){return pn.call(this,tt)||this}var wn,vn=(i(yn,wn=ht),yn);function yn(){return wn.call(this,nt)||this}var _n,Cn,In=(i(En,_n=ht),En);function En(){return _n.call(this,at)||this}function Sn(t){var e=Cn.call(this,st)||this;return e.errMsg=t,e}i(Sn,Cn=ht);var Wn,Tn=(i(bn,Wn=ht),bn);function bn(){return Wn.call(this,rt)||this}var xn,Dn=(i(An,xn=ht),An);function An(){return xn.call(this,it)||this}var Rn,Pn=(i(Mn,Rn=ht),Mn);function Mn(){return Rn.call(this,ot)||this}var Nn,kn=(i(Ln,Nn=ht),Ln);function Ln(){return Nn.call(this,et)||this}var Fn,On=(i(Un,Fn=ht),Un);function Un(){return Fn.call(this,ct)||this}var Gn,Hn=(i(Bn,Gn=ht),Bn);function Bn(){return Gn.call(this,G)||this}var Vn,zn=(i(jn,Vn=ht),jn);function jn(){return Vn.call(this,H)||this}var Xn,qn=(i(Yn,Xn=ht),Yn);function Yn(t,e){var n=Xn.call(this,B)||this;return n.dialogType=t,n.pageUrl=e,n}var Kn,Jn=(i($n,Kn=ht),$n);function $n(t,e,n){var r=Kn.call(this,V)||this;return r.dialogType=t,r.errMsg=e,r.pageUrl=n,r}var Qn="_nativeMethods",Zn=(tr.prototype._ensureNativeMethods=function(t){return t||{objectKeys:Object.keys,arrayForEach:Array.prototype.forEach,arrayConcat:Array.prototype.concat,arraySlice:Array.prototype.slice,objectDefineProperty:Object.defineProperty}},tr.prototype._getWindowIds=function(t){return this[Qn].objectKeys(t)},tr.prototype._copyArray=function(t){return this[Qn].arraySlice.call(t)},tr.prototype._concatArrays=function(t,e){return this[Qn].arrayConcat.call(t,e)},tr.prototype.ensureMessageContainer=function(t){this[t]||(this[t]={log:[],info:[],warn:[],error:[]})},tr.prototype.concat=function(e){var n=this;if(!e)return this;var t=this._getWindowIds(e);return this[Qn].arrayForEach.call(t,function(t){n.ensureMessageContainer(t),n[t].log=n._concatArrays(n[t].log,e[t].log),n[t].info=n._concatArrays(n[t].info,e[t].info),n[t].warn=n._concatArrays(n[t].warn,e[t].warn),n[t].error=n._concatArrays(n[t].error,e[t].error)}),this},tr.prototype.addMessage=function(t,e,n){this.ensureMessageContainer(n),this[n][t].push(e)},tr.prototype.getCopy=function(){var e=this,n={},t=this._getWindowIds(this);return this[Qn].arrayForEach.call(t,function(t){n[t]={log:e._copyArray(e[t].log),info:e._copyArray(e[t].info),warn:e._copyArray(e[t].warn),error:e._copyArray(e[t].error)}}),n},tr);function tr(t,e){var n=this._ensureNativeMethods(e);n.objectDefineProperty(this,Qn,{value:n}),this.concat(t)}var er,nr=(i(rr,er=Zn),rr);function rr(t){return er.call(this,t,c.nativeMethods)||this}var ir=(or.prototype._getAssignableProperties=function(){throw new Error("Not implemented")},or.prototype._assignFrom=function(t,e,n){if(void 0===n&&(n={}),t)for(var r=this._getAssignableProperties(),i=0;i<r.length;i++){for(var o,s=r[i],a=s.name,c=s.type,l=s.required,u=s.init,d=s.defaultValue,h=a.split("."),f=h.length-1,p=h[f],m=t,g=this,w=0;w<f&&m&&g;w++)m=m[h[w]],g=g[h[w]];g&&"defaultValue"in r[i]&&(g[a]=d),m&&g&&(void 0===(o=m[p])&&!l||(e&&c&&c(a,o),g[p]=u?u(a,o,n):o))}},or);function or(){}function sr(){return c.nativeMethods.performanceNow().toString()}var ar,cr=(i(lr,ar=ir),lr.prototype._getAssignableProperties=function(){return[{name:"isCommandResult"},{name:"executionError"},{name:"pageError"},{name:"result"},{name:"consoleMessages"},{name:"isPendingWindowSwitching"},{name:"isFirstRequestAfterWindowSwitching"}]},lr);function lr(t){var e=ar.call(this,t)||this;return e.id=sr(),e.isCommandResult=!1,e.executionError=null,e.pageError=null,e.resent=!1,e.result=null,e.consoleMessages=null,e.isPendingWindowSwitching=!1,e.isFirstRequestAfterWindowSwitching=!1,e._assignFrom(t,!0),e}var ur,dr=(function(t){function r(t,e){this.references=t,this.transforms=e,this.circularCandidates=[],this.circularCandidatesDescrs=[],this.circularRefCount=0}var o=/^#*@(t|r)$/,i=(0,eval)("this"),n="function"==typeof ArrayBuffer,s="function"==typeof Map,a="function"==typeof Set,c=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"],l=Array.prototype.slice,e={serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return JSON.parse(t)}};function u(t,e){this.references=t,this.transformMap=e,this.activeTransformsStack=[],this.visitedRefs=Object.create(null)}r._createRefMark=function(t){var e=Object.create(null);return e["@r"]=t,e},r.prototype._createCircularCandidate=function(t,e,n){this.circularCandidates.push(t),this.circularCandidatesDescrs.push({parent:e,key:n,refIdx:-1})},r.prototype._applyTransform=function(t,e,n,r){var i=Object.create(null),o=r.toSerializable(t);return"object"==typeof o&&this._createCircularCandidate(t,e,n),i["@t"]=r.type,i.data=this._handleValue(o,e,n),i},r.prototype._handleArray=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=this._handleValue(t[n],e,n);return e},r.prototype._handlePlainObject=function(n){var r=this,i=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){var e=o.test(t)?"#"+t:t;i[e]=r._handleValue(n[t],i,e)}),i},r.prototype._handleObject=function(t,e,n){return this._createCircularCandidate(t,e,n),Array.isArray(t)?this._handleArray(t):this._handlePlainObject(t)},r.prototype._ensureCircularReference=function(t){var e=this.circularCandidates.indexOf(t);if(-1<e){var n=this.circularCandidatesDescrs[e];return-1===n.refIdx&&(n.refIdx=n.parent?++this.circularRefCount:0),r._createRefMark(n.refIdx)}return null},r.prototype._handleValue=function(t,e,n){var r=typeof t,i="object"==r&&null!==t;if(i){var o=this._ensureCircularReference(t);if(o)return o}for(var s=0;s<this.transforms.length;s++){var a=this.transforms[s];if(a.shouldTransform(r,t))return this._applyTransform(t,e,n,a)}return i?this._handleObject(t,e,n):t},r.prototype.transform=function(){for(var t=[this._handleValue(this.references,null,null)],e=0;e<this.circularCandidatesDescrs.length;e++){var n=this.circularCandidatesDescrs[e];0<n.refIdx&&(t[n.refIdx]=n.parent[n.key],n.parent[n.key]=r._createRefMark(n.refIdx))}return t},u.prototype._handlePlainObject=function(e){var t,n=this,r=Object.create(null),i=Object.getOwnPropertyNames(e);for(t in i.forEach(function(t){n._handleValue(e[t],e,t),o.test(t)&&(r[t.substring(1)]=e[t],delete e[t])}),r)e[t]=r[t]},u.prototype._handleTransformedObject=function(t,e,n){var r=t["@t"],i=this.transformMap[r];if(!i)throw new Error("Can't find transform for \""+r+'" type.');this.activeTransformsStack.push(t),this._handleValue(t.data,t,"data"),this.activeTransformsStack.pop(),e[n]=i.fromSerializable(t.data)},u.prototype._handleCircularSelfRefDuringTransform=function(t,e,n){var r=this.references,i=void 0;Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return void 0===i&&(i=r[t]),i},set:function(t){return i=t}})},u.prototype._handleCircularRef=function(t,e,n){-1<this.activeTransformsStack.indexOf(this.references[t])?this._handleCircularSelfRefDuringTransform(t,e,n):(this.visitedRefs[t]||(this.visitedRefs[t]=!0,this._handleValue(this.references[t],this.references,t)),e[n]=this.references[t])},u.prototype._handleValue=function(t,e,n){if("object"==typeof t&&null!==t){var r=t["@r"];if(void 0!==r)this._handleCircularRef(r,e,n);else if(t["@t"])this._handleTransformedObject(t,e,n);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this._handleValue(t[i],t,i);else this._handlePlainObject(t)}},u.prototype.transform=function(){return this.visitedRefs[0]=!0,this._handleValue(this.references[0],this.references,0),this.references[0]};var d=[{type:"[[NaN]]",shouldTransform:function(t,e){return"number"===t&&isNaN(e)},toSerializable:function(){return""},fromSerializable:function(){return NaN}},{type:"[[undefined]]",shouldTransform:function(t){return"undefined"===t},toSerializable:function(){return""},fromSerializable:function(){}},{type:"[[Date]]",shouldTransform:function(t,e){return e instanceof Date},toSerializable:function(t){return t.getTime()},fromSerializable:function(t){var e=new Date;return e.setTime(t),e}},{type:"[[RegExp]]",shouldTransform:function(t,e){return e instanceof RegExp},toSerializable:function(t){var e={src:t.source,flags:""};return t.global&&(e.flags+="g"),t.ignoreCase&&(e.flags+="i"),t.multiline&&(e.flags+="m"),e},fromSerializable:function(t){return new RegExp(t.src,t.flags)}},{type:"[[Error]]",shouldTransform:function(t,e){return e instanceof Error},toSerializable:function(t){return{name:t.name,message:t.message,stack:t.stack}},fromSerializable:function(t){var e=new(i[t.name]||Error)(t.message);return e.stack=t.stack,e}},{type:"[[ArrayBuffer]]",shouldTransform:function(t,e){return n&&e instanceof ArrayBuffer},toSerializable:function(t){var e=new Int8Array(t);return l.call(e)},fromSerializable:function(t){if(n){var e=new ArrayBuffer(t.length);return new Int8Array(e).set(t),e}return t}},{type:"[[TypedArray]]",shouldTransform:function(t,e){for(var n=0;n<c.length;n++){var r=c[n];if("function"==typeof i[r]&&e instanceof i[r])return!0}return!1},toSerializable:function(t){return{ctorName:t.constructor.name,arr:l.call(t)}},fromSerializable:function(t){return"function"==typeof i[t.ctorName]?new i[t.ctorName](t.arr):t.arr}},{type:"[[Map]]",shouldTransform:function(t,e){return s&&e instanceof Map},toSerializable:function(t){var n=[];return t.forEach(function(t,e){n.push(e),n.push(t)}),n},fromSerializable:function(t){if(s){for(var e=new Map,n=0;n<t.length;n+=2)e.set(t[n],t[n+1]);return e}for(var r=[],i=0;i<t.length;i+=2)r.push([t[n],t[n+1]]);return r}},{type:"[[Set]]",shouldTransform:function(t,e){return a&&e instanceof Set},toSerializable:function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},fromSerializable:function(t){if(a){for(var e=new Set,n=0;n<t.length;n++)e.add(t[n]);return e}return t}}],h=t.exports=function(t){this.transforms=[],this.transformsMap=Object.create(null),this.serializer=t||e,this.addTransforms(d)};h.prototype.addTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e];if(this.transformsMap[n.type])throw new Error('Transform with type "'+n.type+'" was already added.');this.transforms.push(n),this.transformsMap[n.type]=n}return this},h.prototype.removeTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e],r=this.transforms.indexOf(n);-1<r&&this.transforms.splice(r,1),delete this.transformsMap[n.type]}return this},h.prototype.encode=function(t){var e=new r(t,this.transforms).transform();return this.serializer.serialize(e)},h.prototype.decode=function(t){var e=this.serializer.deserialize(t);return new u(e,this.transformsMap).transform()}}(ur={exports:{}}),ur.exports);function hr(t,e){return new c.nativeMethods.Function("fnCode","__dependencies$","Promise","RegExp",'"use strict"; return eval(fnCode)')(t,e,c.Promise,RegExp)}var fr=["nodeType","textContent","childNodeCount","hasChildNodes","childElementCount","hasChildElements"],pr=["tagName","attributes"],mr=["tagName","visible","focused","attributes","boundingClientRect","classNames","style","innerText","namespaceURI","id","value","checked","selected","selectedIndex","scrollWidth","scrollHeight","scrollLeft","scrollTop","offsetWidth","offsetHeight","offsetLeft","offsetTop","clientWidth","clientHeight","clientLeft","clientTop"],gr={textContent:function(t){return t.textContent},childNodeCount:function(t){return t.childNodes.length},hasChildNodes:function(t){return!!gr.childNodeCount(t)},childElementCount:function(t){var e=t.children;if(e)return e.length;for(var n=0,r=t.childNodes.length,i=0;i<r;i++)1===t.childNodes[i].nodeType&&n++;return n},hasChildElements:function(t){return!!gr.childElementCount(t)}},wr=(vr.prototype._initializeProperties=function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r],o=n[i];this[i]=o?o(t):t[i]}},vr);function vr(){}var yr,_r=(i(Cr,yr=wr),Cr);function Cr(t){var e=yr.call(this)||this;return e._initializeProperties(t,fr,gr),e}var Ir,Er={tagName:function(t){return t.tagName.toLowerCase()},visible:y.positionUtils.isElementVisible,focused:function(t){return y.domUtils.getActiveElement()===t},attributes:function(t){for(var e=t.attributes,n={},r=e.length-1;0<=r;r--)n[e[r].name]=e[r].value;return n},boundingClientRect:function(t){var e=t.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}},classNames:function(t){var e=t.className;return(e="string"==typeof e.animVal?e.animVal:e).replace(/^\s+|\s+$/g,"").split(/\s+/g)},style:function(t){for(var e={},n=Ya.getComputedStyle(t),r=0;r<n.length;r++){var i=n[r];e[i]=n[i]}return e},innerText:function(t){return t.innerText}},Sr=(i(Wr,Ir=wr),Wr);function Wr(t){var e=Ir.call(this,t)||this;return e._initializeProperties(t,pr,Er),e}var Tr,br=(i(xr,Tr=_r),xr);function xr(t){var e=Tr.call(this,t)||this;return e._initializeProperties(t,mr,Er),e}function Dr(t){return t}var Ar=Ya.Node;function Rr(t){return new dr({serialize:Dr,deserialize:Dr}).addTransforms(t)}var Pr=(Mr.prototype.shouldTransform=function(t){return"function"===t},Mr.prototype.toSerializable=function(){return""},Mr.prototype.fromSerializable=function(t){return hr(t.fnCode,t.dependencies)},Mr);function Mr(){this.type="Function"}var Nr=(kr.prototype.shouldTransform=function(t,e){return e instanceof Ar},kr.prototype.toSerializable=function(t){return new Sr(t)},kr);function kr(){this.type="Node"}var Lr=(Fr.prototype._extend=function(t,n){var r=this;o.nativeMethods.objectKeys.call(Ya.Object,this.customDOMProperties).forEach(function(e){try{t[e]=r.customDOMProperties[e](n)}catch(t){throw new Ot(r.instantiationCallsiteName,t,e)}})},Fr.prototype.shouldTransform=function(t,e){return e instanceof Ar},Fr.prototype.toSerializable=function(t){var e=new(1===t.nodeType?br:_r)(t);return this._extend(e,t),e},Fr);function Fr(t){this.type="Node",this.customDOMProperties=t||{}}var Or=(Ur.prototype.shouldTransform=function(t,e){if(e instanceof Ar)throw new _t(this.instantiationCallsiteName)},Ur);function Ur(t){this.type="Node",this.instantiationCallsiteName=t}var Gr=(Hr.prototype.getResult=function(){var e=this;return c.Promise.resolve().then(function(){var t=e.replicator.decode(e.command.args);return e._executeFn(t)}).catch(function(t){throw t.isTestCafeError||(t=new kt(e.command.instantiationCallsiteName,t)),t})},Hr.prototype.getResultDriverStatus=function(){var e=this;return this.getResult().then(function(t){return new cr({isCommandResult:!0,result:e.replicator.encode(t)})}).catch(function(t){return new cr({isCommandResult:!0,executionError:t})})},Hr.prototype._createReplicator=function(){return Rr([new Or(this.command.instantiationCallsiteName),new Pr])},Hr.prototype._executeFn=function(t){return this.fn.apply(Ya,t)},Hr);function Hr(t){this.command=t,this.replicator=this._createReplicator(),this.dependencies=this.replicator.decode(this.command.dependencies),this.fn=hr(this.command.fnCode,this.dependencies)}var Br="appeared-dialog",Vr="unexpected-dialog",zr="handler-error",jr=o.eventSandbox.message,Xr=o.processScript,qr=o.nativeMethods,Yr="testcafe|native-dialog-tracker|appeared-dialogs",Kr="testcafe|native-dialog-tracker|unexpected-dialog",Jr="testcafe|native-dialog-tracker|error-in-handler",$r=Xr("window.location.href"),Qr=(Object.defineProperty(Zr.prototype,"appearedDialogs",{get:function(){var t=this.contextStorage.getItem(Yr);return t||(t=[],this.appearedDialogs=t),t},set:function(t){this.contextStorage.setItem(Yr,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Zr.prototype,"unexpectedDialog",{get:function(){return this.contextStorage.getItem(Kr)},set:function(t){this.contextStorage.setItem(Kr,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Zr.prototype,"handlerError",{get:function(){return this.contextStorage.getItem(Jr)},set:function(t){this.contextStorage.setItem(Jr,t)},enumerable:!1,configurable:!0}),Zr._getPageUrl=function(){return qr.eval($r)},Zr.prototype._initListening=function(){var n=this;jr.on(jr.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;e.type===Br?n._addAppearedDialogs(e.dialogType,e.text,e.url):e.type!==Vr||n.unexpectedDialog?e.type!==zr||n.handlerError||n._onHandlerError(e.dialogType,e.message,e.url):n.unexpectedDialog={type:e.dialogType,url:e.url}})},Zr.prototype._init=function(){var e=this;o.on(o.EVENTS.beforeUnload,function(t){t.prevented&&!t.isFakeIEEvent&&(e.dialogHandler?e._createDialogHandler("beforeunload")(t.returnValue||""):e._defaultDialogHandler("beforeunload")),e.contextStorage&&e.contextStorage.save()}),Ya.alert=function(){return e._defaultDialogHandler("alert")},Ya.confirm=function(){return e._defaultDialogHandler("confirm")},Ya.prompt=function(){return e._defaultDialogHandler("prompt")}},Zr.prototype._createDialogHandler=function(i){var o=this;return function(t){var e=Zr._getPageUrl();o._addAppearedDialogs(i,t,e);var n=new Gr(o.dialogHandler),r=null;try{r=n.fn.apply(Ya,[i,t,e])}catch(t){o._onHandlerError(i,t.message||String(t),e)}return r}},Zr.prototype._defaultDialogHandler=function(t){var e=Zr._getPageUrl();this.unexpectedDialog=this.unexpectedDialog||{type:t,url:e}},Zr.prototype._addAppearedDialogs=function(t,e,n){this.appearedDialogs.splice(0,0,{type:t,text:e,url:n})},Zr.prototype._onHandlerError=function(t,e,n){this.handlerError=this.handlerError||{type:t,message:e,url:n}},Zr.prototype.setHandler=function(t){var e=this;this.dialogHandler=t,["alert","confirm","prompt"].forEach(function(t){Ya[t]=e.dialogHandler?e._createDialogHandler(t):function(){return e._defaultDialogHandler(t)}})},Zr.prototype.getUnexpectedDialogError=function(){var t=this.unexpectedDialog,e=this.handlerError;return this.unexpectedDialog=null,this.handlerError=null,t?new qn(t.type,t.url):e?new Jn(e.type,e.message,e.url):null},Zr);function Zr(t,e){this.contextStorage=t,this.dialogHandler=e,this._init(),this._initListening(),this.dialogHandler&&this.setHandler(e)}function ti(t){this.type=t,this.id=sr()}var ei,ni="driver|establish-connection",ri="driver|switch-to-window",ii="driver|close-window",oi="driver|close-window-validation",si="driver|switch-to-window-validation",ai="driver|get-windows",ci="driver|command-executed",li="driver|execute-command",ui="driver|confirmation",di="driver|set-native-dialog-handler",hi="driver|set-as-master",fi="driver|close-all-child-windows",pi="driver|start-to-restore-child-link",mi="driver|restore-child-link",gi="driver|child-window-is-loaded-in-iframe",wi="driver|child-window-is-opened-in-iframe",vi=(i(yi,ei=ti),yi);function yi(){return ei.call(this,ni)||this}var _i,Ci=(i(Ii,_i=ti),Ii);function Ii(t){var e=t.windowId,n=_i.call(this,oi)||this;return n.windowId=e,n}var Ei,Si=(i(Wi,Ei=ti),Wi);function Wi(t){var e=t.windowId,n=t.fn,r=Ei.call(this,si)||this;return r.windowId=e,r.fn=n,r}var Ti,bi=(i(xi,Ti=ti),xi);function xi(){return Ti.call(this,ai)||this}var Di,Ai=(i(Ri,Di=ti),Ri);function Ri(t){var e=t.windowId,n=t.isCurrentWindow,r=Di.call(this,ii)||this;return r.windowId=e,r.isCurrentWindow=n,r}var Pi,Mi=(i(Ni,Pi=ti),Ni);function Ni(t){var e=t.windowId,n=t.fn,r=Pi.call(this,ri)||this;return r.windowId=e,r.fn=n,r}var ki,Li=(i(Fi,ki=ti),Fi);function Fi(t){var e=ki.call(this,ci)||this;return e.driverStatus=t,e}var Oi,Ui=(i(Gi,Oi=ti),Gi);function Gi(t,e){var n=Oi.call(this,li)||this;return n.command=t,n.testSpeed=e,n}var Hi,Bi=(i(Vi,Hi=ti),Vi);function Vi(t,e){var n=Hi.call(this,ui)||this;return n.requestMessageId=t,n.result=e,n}var zi,ji=(i(Xi,zi=ti),Xi);function Xi(t){var e=zi.call(this,di)||this;return e.dialogHandler=t,e}var qi,Yi=(i(Ki,qi=ti),Ki);function Ki(t){var e=qi.call(this,hi)||this;return e.finalizePendingCommand=t,e}var Ji,$i=(i(Qi,Ji=ti),Qi);function Qi(){return Ji.call(this,fi)||this}var Zi,to=(i(eo,Zi=ti),eo);function eo(){return Zi.call(this,pi)||this}var no,ro=(i(io,no=ti),io);function io(t){var e=no.call(this,mi)||this;return e.windowId=t,e}var oo,so=(i(ao,oo=ti),ao);function ao(t){var e=oo.call(this,gi)||this;return e.windowId=t,e}var co,lo=(i(uo,co=ti),uo);function uo(){return co.call(this,wi)||this}var ho=o.json,fo=o.nativeMethods,po=(mo.prototype._createStorageKey=function(t,e){var n="testcafe|driver|"+t;return e?n+"|"+e:n},mo.prototype._loadFromStorage=function(){var t=fo.storageGetItem.call(this.storage,this.storageKey);t&&(this.data=ho.parse(t),fo.storageRemoveItem.call(this.storage,this.storageKey))},mo.prototype.save=function(){fo.storageSetItem.call(this.storage,this.storageKey,ho.stringify(this.data))},mo.prototype.setItem=function(t,e){this.data[t]=e,this.save()},mo.prototype.getItem=function(t){return this.data[t]},mo.prototype.dispose=function(){fo.storageRemoveItem.call(this.storage,this.storageKey)},mo);function mo(t,e,n){this.storage=fo.winSessionStorageGetter.call(t),this.storageKey=this._createStorageKey(e,n),this.data={},this._loadFromStorage()}function go(n,t,e,r){var i=null,o=null,s=null;return e=Math.max(e||0,2500),c.Promise.race([y.delay(e),new c.Promise(function(e){s=function(t){t.message.type===ui&&t.message.requestMessageId===n.id&&e(t.message)},c.eventSandbox.message.on(c.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),i=c.nativeMethods.setInterval.call(Ya,function(){return c.eventSandbox.message.sendServiceMsg(n,t)},1e3),c.eventSandbox.message.sendServiceMsg(n,t)})]).then(function(t){if(c.nativeMethods.clearInterval.call(Ya,i),c.nativeMethods.clearTimeout.call(Ya,o),c.eventSandbox.message.off(c.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),!t)throw new r;return t})}var wo=2e4;function vo(t){var e=t.requestMsgId,n=t.result,r=t.window,i=new Bi(e,n);c.eventSandbox.message.sendServiceMsg(i,r)}var yo=(Object.defineProperty(_o.prototype,"availabilityTimeout",{set:function(t){this.iframeAvailabilityTimeout=t},enumerable:!1,configurable:!0}),_o.prototype._ensureIframe=function(){var t=this;return y.domUtils.isElementInDocument(this.driverIframe)?y.waitFor(function(){return y.positionUtils.isElementVisible(t.driverIframe)?t.driverIframe:null},200,this.iframeAvailabilityTimeout).catch(function(){throw new zn}):c.Promise.reject(new Hn)},_o.prototype._waitForIframeRemovedOrHidden=function(){var e=this;return new c.Promise(function(t){e.checkIframeInterval=c.nativeMethods.setInterval.call(Ya,function(){e._ensureIframe().catch(function(){return y.delay(500).then(function(){return t(new cr({isCommandResult:!0}))})})},1e3)})},_o.prototype._waitForCommandResult=function(){var e=this,n=null;return c.Promise.race([this._waitForIframeRemovedOrHidden(),new c.Promise(function(e){n=function(t){t.message.type===ci&&e(t.message.driverStatus)},c.eventSandbox.message.on(c.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n)})]).then(function(t){return c.eventSandbox.message.off(c.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n),c.nativeMethods.clearInterval.call(Ya,e.checkIframeInterval),t})},_o.prototype.sendConfirmationMessage=function(t){vo({requestMsgId:t,result:{id:this.driverId},window:this.driverWindow})},_o.prototype.executeCommand=function(e,n){var r=this;return this._ensureIframe().then(function(){var t=new Ui(e,n);return c.Promise.all([go(t,r.driverWindow,r.iframeAvailabilityTimeout,nn),r._waitForCommandResult()])}).then(function(t){return t[1]})},_o);function _o(t,e){this.driverWindow=t,this.driverIframe=y.domUtils.findIframeByWindow(t),this.driverId=e,this.iframeAvailabilityTimeout=0}var Co=o.Promise,Io=o.nativeMethods,Eo=(So.prototype._onScriptElementAdded=function(t){var e,n,r=this,i=Io.scriptSrcGetter.call(t);void 0!==i&&""!==i&&(this.scriptsCount++,e=null,n=function(){Io.removeEventListener.call(t,"load",n),Io.removeEventListener.call(t,"error",n),Io.clearTimeout.call(Ya,e),r._onScriptLoadedOrFailed()},Io.addEventListener.call(t,"load",n),Io.addEventListener.call(t,"error",n),e=Io.setTimeout.call(Ya,n,this.SCRIPT_LOADING_TIMEOUT))},So.prototype._onScriptLoadedOrFailed=function(){var t=this;this.scriptsCount--,this.scriptsCount||y.delay(25).then(function(){t.resolveWaitingPromise&&(t.scriptsCount||t.resolveWaitingPromise())})},So.prototype.wait=function(){var n=this;return new Co(function(t){function e(){Io.clearTimeout.call(Ya,n.watchdog),o.off(o.EVENTS.scriptElementAdded,n.scriptElementAddedHandler),n.watchdog=null,n.resolveWaitingPromise=null,t()}n.scriptsCount?(n.watchdog=Io.setTimeout.call(Ya,e,n.BARRIER_TIMEOUT),n.resolveWaitingPromise=e):e()})},So);function So(){var e=this;this.watchdog=null,this.SCRIPT_LOADING_TIMEOUT=2e3,this.BARRIER_TIMEOUT=3e3,this.scriptsCount=0,this.resolveWaitingPromise=null,this.scriptElementAddedHandler=function(t){return e._onScriptElementAdded(t.el)},o.on(o.EVENTS.scriptElementAdded,this.scriptElementAddedHandler)}function Wo(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=new y.RequestBarrier,i=new Eo;y.pageUnloadBarrier.watchForPageNavigationTriggers();var o=null,s=t.apply(void 0,e),a=s.then(function(t){return o=t,c.Promise.all([r.wait().then(function(){return i.wait()}),y.pageUnloadBarrier.wait()])}).then(function(){return o});return{actionPromise:s,barriersPromise:a}}var To,bo=Array.isArray,xo=Ya.Node,Do=Ya.HTMLCollection,Ao=Ya.NodeList;function Ro(t){return!!t}function Po(t){return!(!y.domUtils.isDomElement(t)&&!y.domUtils.isTextNode(t))&&(y.domUtils.isOptionElement(t)||"optgroup"===y.domUtils.getTagName(t)?n.selectElement.isOptionElementVisible(t):y.positionUtils.isElementVisible(t))}function Mo(t){return t instanceof Do||t instanceof Ao||function(t){if(bo(t)){for(var e=0;e<t.length;e++)if(!(t[e]instanceof xo))return;return 1}}(t)}var No=t.arrayUtils,ko=o.utils.types,Lo=o.nativeMethods,Fo=1,Oo=2,Uo=3,Go=((To={})[Fo]=/^\.filterVisible\(\)$/,To[Oo]=/^\.filterHidden\(\)$/,To[Uo]=/^\.nth\(\d+\)$/,To),Ho=(Object.defineProperty(Bo.prototype,"error",{get:function(){return this.err},set:function(t){null===this.err&&(this.err=t)},enumerable:!1,configurable:!0}),Bo.prototype.filter=function(t,e,n){var r,i=No.filter(t,Ro);return e.filterVisible&&(i=i.filter(Po),this.assertFilterError(i,n,Fo)),e.filterHidden&&(i=i.filter(function(t){return!Po(t)}),this.assertFilterError(i,n,Oo)),e.counterMode?i=null!==e.index?this.getNodeByIndex(i,e.index)?1:0:i.length:(e.collectionMode?null!==e.index&&(i=(r=this.getNodeByIndex(i,e.index))?[r]:[]):i=this.getNodeByIndex(i,e.index||0),"number"==typeof e.index&&this.assertFilterError(i,n,Uo)),i},Bo.prototype.cast=function(t){var e=null;if(ko.isNullOrUndefined(t))e=[];else if(t instanceof Node)e=[t];else{if(!Mo(t))throw new Tt;e=t}return e},Bo.prototype.assertFilterError=function(t,e,n){t&&0!==t.length||(this.error=this.getErrorItem(e,n))},Bo.prototype.getErrorItem=function(t,e){var n=t.apiFnChain,r=t.apiFnID;if(e)for(var i=r;i<n.length;i++)if(Go[e].test(n[i]))return i;return null},Bo.prototype.getNodeByIndex=function(t,e){return e<0?t[t.length+e]:t[e]},Bo);function Bo(){this.err=null}Lo.objectDefineProperty.call(Ya,Ya,"%testCafeSelectorFilter%",{value:new Ho,configurable:!0});var Vo,zo=c.nativeMethods.date,jo=(i(Xo,Vo=Gr),Xo.prototype._createReplicator=function(){return Rr([new Pr])},Xo.prototype._getTimeoutErrorParams=function(){var t=Ya["%testCafeSelectorFilter%"].error,e=this.command.apiFnChain;return void 0!==t?{apiFnIndex:t,apiFnChain:e}:null},Xo.prototype._getTimeoutError=function(t){return t?this.createIsInvisibleError:this.createNotFoundError},Xo.prototype._validateElement=function(o,s){var a=this;return c.Promise.resolve().then(function(){return a.fn.apply(Ya,o)}).then(function(t){var e=!!t,n=!a.command.visibilityCheck||Po(t),r=new zo-s>=a.timeout;if(e&&(n||y.domUtils.isShadowRoot(t)))return t;if(!r)return y.delay(200).then(function(){return a._validateElement(o,s)});var i=a.getVisibleValueMode?null:a._getTimeoutError(e);if(i)throw i(a._getTimeoutErrorParams());return null})},Xo.prototype._executeFn=function(t){if(this.counterMode)return Vo.prototype._executeFn.call(this,t);var e=new zo,n=null,r=null;return this._validateElement(t,e).catch(function(t){n=t}).then(function(t){if(n)throw n;r=t}).then(function(){return r})},Xo);function Xo(t,e,n,r,i){var o,s=Vo.call(this,t)||this;s.createNotFoundError=r,s.createIsInvisibleError=i,s.timeout="number"==typeof t.timeout?t.timeout:e,s.counterMode=s.dependencies.filterOptions.counterMode,s.getVisibleValueMode=s.dependencies.filterOptions.getVisibleValueMode,n&&(o=new zo-n,s.timeout=Math.max(s.timeout-o,0));var a=s.dependencies&&s.dependencies.customDOMProperties;return s.replicator.addTransforms([new Lr(a)]),s}var qo=c.nativeMethods.date,Yo=(Ko.prototype._ensureElement=function(t){var e=this,n=t.selector,r=t.createNotFoundError,i=t.createIsInvisibleError,o=t.createHasWrongNodeTypeError;this.ensureElementsPromise=this.ensureElementsPromise.then(function(){return new jo(n,e.globalSelectorTimeout,e.ensureElementsStartTime,r,i).getResult()}).then(function(t){if(!y.domUtils.isDomElement(t))throw o(y.NODE_TYPE_DESCRIPTIONS[t.nodeType]);e.elements.push(t)})},Ko.prototype.getElements=function(){var t=this;return this.ensureElementsPromise.then(function(){return t.elements})},Ko);function Ko(t,e){var n=this;this.elements=[],this.globalSelectorTimeout=e,this.ensureElementsPromise=c.Promise.resolve(),this.ensureElementsStartTime=new qo,t.forEach(function(t){return n._ensureElement(t)})}function Jo(t,e){return new Yo(t,e).getElements()}function $o(t){return{selector:t,createNotFoundError:function(t){return new oe(t)},createIsInvisibleError:function(){return new ce},createHasWrongNodeTypeError:function(t){return new de(t)}}}function Qo(t,e){return{selector:t,createNotFoundError:function(t){return new pe(e,t)},createIsInvisibleError:function(){return new we(e)},createHasWrongNodeTypeError:function(t){return new _e(e,t)}}}function Zo(t,e){if(!y.domUtils.isContentEditableElement(t))throw new De(e)}var ts=c.nativeMethods.date,es=(ns.prototype._getSpecificTimeout=function(){return this.command.selector&&"number"==typeof this.command.selector.timeout?this.command.selector.timeout:this.globalSelectorTimeout},ns.prototype._delayAfterExecution=function(){return this.command.options&&1!==this.command.options.speed?y.delay(2e3*(1-this.command.options.speed)):c.Promise.resolve()},ns.prototype._isExecutionTimeoutExpired=function(){return c.nativeMethods.dateNow()-this.executionStartTime>=this.commandSelectorTimeout},ns.prototype._ensureCommandArguments=function(){if(this.command.type===f.pressKey&&y.parseKeySequence(this.command.keys).error)throw new ke("keys")},ns.prototype._ensureCommandElements=function(){var e=this,t=[];return this.command.selector&&t.push($o(this.command.selector)),this.command.type===f.dragToElement?t.push(Qo(this.command.destinationSelector,"destinationSelector")):this.command.type===f.selectEditableContent&&(t.push(Qo(this.command.startSelector,"startSelector")),t.push(Qo(this.command.endSelector||this.command.startSelector,"endSelector"))),Jo(t,this.globalSelectorTimeout).then(function(t){e.elements=t})},ns.prototype._ensureCommandElementsProperties=function(){this.command.type===f.selectText?function(t){if(!y.domUtils.isEditableElement(t))throw new Ee}(this.elements[0]):this.command.type===f.selectTextAreaContent?function(t){if(!y.domUtils.isTextAreaElement(t))throw new Te}(this.elements[0]):this.command.type===f.selectEditableContent?(Zo(this.elements[0],"startSelector"),Zo(this.elements[1],"endSelector"),function(t){if(!y.contentEditable.getNearestCommonAncestor(t[0],t[1]))throw new Pe}(this.elements)):this.command.type!==f.setFilesToUpload&&this.command.type!==f.clearUpload||function(t){if(!y.domUtils.isFileInput(t))throw new He}(this.elements[0])},ns.prototype._ensureCommandOptions=function(){var t,e,n,r,i;this.elements.length&&this.command.options&&"offsetX"in this.command.options&&"offsetY"in this.command.options&&(t=this.elements[0],e=this.command.options,n=_.getOffsetOptions(t,e.offsetX,e.offsetY),r=n.offsetX,i=n.offsetY,e.offsetX=r,e.offsetY=i)},ns.prototype._createAutomation=function(){var t;switch(this.command.type){case f.click:return/option|optgroup/.test(y.domUtils.getTagName(this.elements[0]))?new _.SelectChildClick(this.elements[0],this.command.options):new _.Click(this.elements[0],this.command.options);case f.rightClick:return new _.RClick(this.elements[0],this.command.options);case f.doubleClick:return new _.DblClick(this.elements[0],this.command.options);case f.hover:return new _.Hover(this.elements[0],this.command.options);case f.drag:return new _.DragToOffset(this.elements[0],this.command.dragOffsetX,this.command.dragOffsetY,this.command.options);case f.dragToElement:return new _.DragToElement(this.elements[0],this.elements[1],this.command.options);case f.typeText:return new _.Type(this.elements[0],this.command.text,this.command.options);case f.selectText:case f.selectTextAreaContent:return t=_.calculateSelectTextArguments(this.elements[0],this.command),new _.SelectText(this.elements[0],t.startPos,t.endPos,this.command.options);case f.selectEditableContent:return new _.SelectEditableContent(this.elements[0],this.elements[1],this.command.options);case f.pressKey:return new _.Press(y.parseKeySequence(this.command.keys).combinations,this.command.options);case f.setFilesToUpload:return new _.Upload(this.elements[0],this.command.filePath,function(t,e){return new Oe(t,e)});case f.clearUpload:return new _.Upload(this.elements[0])}return null},ns.prototype._runAction=function(e){var n=this;return this._ensureCommandElements().then(function(){return n._ensureCommandElementsProperties()}).then(function(){n._ensureCommandOptions();var t=n._createAutomation();return t.TARGET_ELEMENT_FOUND_EVENT?t.on(t.TARGET_ELEMENT_FOUND_EVENT,function(t){n.targetElement=t.element,n.statusBar.hideWaitingElementStatus(!0),n.executionStartedHandler()}):(n.statusBar.hideWaitingElementStatus(!0),n.executionStartedHandler()),t.run(e)})},ns.prototype._runRecursively=function(){var e=this,t=!1,n=!0;return y.promiseUtils.whilst(function(){return!t},function(){return e._runAction(n).then(function(){t=!0}).catch(function(t){if(e._isExecutionTimeoutExpired()){if(t.message===_.ERROR_TYPES.foundElementIsNotTarget)return n=!1,c.Promise.resolve();throw t.message===_.ERROR_TYPES.elementIsInvisibleError?new ce:t}return y.delay(250)})})},ns.prototype.execute=function(){var i=this;return this.command.options&&!this.command.options.speed&&(this.command.options.speed=this.testSpeed),{startPromise:new c.Promise(function(t){i.executionStartedHandler=t}),completionPromise:new c.Promise(function(n){i.executionStartTime=new ts;try{i._ensureCommandArguments()}catch(t){return void n(new cr({isCommandResult:!0,executionError:t}))}i.commandSelectorTimeout=i._getSpecificTimeout(),i.statusBar.showWaitingElementStatus(i.commandSelectorTimeout);var t=Wo(function(){return i._runRecursively()}),e=t.actionPromise,r=t.barriersPromise;e.then(function(){return c.Promise.all([i._delayAfterExecution(),r])}).then(function(){var t={isCommandResult:!0},e=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(i.elements);i.targetElement&&(e[0]=i.targetElement),t.result=Rr(new Nr).encode(e),n(new cr(t))}).catch(function(t){return i.statusBar.hideWaitingElementStatus(!1).then(function(){return n(new cr({isCommandResult:!0,executionError:t}))})})})}},ns);function ns(t,e,n,r){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.testSpeed=r,this.targetElement=null,this.elements=[],this.ensureElementsPromise=null,this.ensureElementsStartTime=null,this.executionStartTime=null,this.executionStartedHandler=null,this.commandSelectorTimeout=null}function rs(t,e,n){return Math.min(Math.max(e,t),n)}function is(t,e){var n="number"==typeof t.min,r="number"==typeof t.max,i="number"==typeof t.length;return i&&(t.length=rs(t.length,0,e)),n&&t.min<0&&(t.min+=e),r&&t.max<0&&(t.max+=e),n||(t.min=r&&i?t.max-t.length:0),r||(t.max=i?t.min+t.length:e),t.min=rs(t.min,0,e),t.max=rs(t.max,0,e),t.length=t.max-t.min,t}function os(t,e,n){return Math.round(t+rs(e-t,0,n)/2)}function ss(r){return function(t,e){var n=typeof e;if("number"!=n)throw new r(t,n);if(isNaN(e)||!isFinite(e)||e!==Math.floor(e))throw new r(t,e)}}var as,cs,ls,us,ds,hs=ss(qt),fs=(cs=ss(as=Jt),function(t,e){if(cs(t,e),e<0)throw new as(t,e)}),ps=(ls=Zt,function(t,e){var n=typeof e;if("boolean"!=n)throw new ls(t,n)}),ms=(us=ne,function(t,e){var n=typeof e;if("number"!=n)throw new us(t,n);if(isNaN(e)||e<.01||1<e)throw new us(t,e)}),gs=(i(ws,ds=ir),ws.prototype._getAssignableProperties=function(){return[{name:"speed",type:ms}]},ws);function ws(t,e){var n=ds.call(this)||this;return n.speed=null,n._assignFrom(t,e),n}var vs,ys=(i(_s,vs=gs),_s.prototype._getAssignableProperties=function(){return vs.prototype._getAssignableProperties.call(this).concat([{name:"offsetX",type:hs},{name:"offsetY",type:hs}])},_s);function _s(t,e){var n=vs.call(this)||this;return n.offsetX=null,n.offsetY=null,n._assignFrom(t,e),n}var Cs,Is=(i(Es,Cs=ys),Es.prototype._getAssignableProperties=function(){return Cs.prototype._getAssignableProperties.call(this).concat([{name:"scrollToCenter",type:ps},{name:"skipParentFrames",type:ps}])},Es);function Es(t,e){var n=Cs.call(this)||this;return n.scrollToCenter=!1,n.skipParentFrames=!1,n._assignFrom(t,e),n}var Ss,Ws=(i(Ts,Ss=gs),Ts.prototype._getAssignableProperties=function(){return Ss.prototype._getAssignableProperties.call(this).concat([{name:"scrollTargetX",type:hs},{name:"scrollTargetY",type:hs},{name:"crop.left",type:hs},{name:"crop.right",type:hs},{name:"crop.top",type:hs},{name:"crop.bottom",type:hs},{name:"includeMargins",type:ps},{name:"includeBorders",type:ps},{name:"includePaddings",type:ps}])},Ts);function Ts(t,e){var n=Ss.call(this)||this;return n.scrollTargetX=null,n.scrollTargetY=null,n.includeMargins=!1,n.includeBorders=!0,n.includePaddings=!0,n.crop={left:null,right:null,top:null,bottom:null},n._assignFrom(t,e),n}var bs,xs=(i(Ds,bs=ys),Ds.prototype._getAssignableProperties=function(){return bs.prototype._getAssignableProperties.call(this).concat([{name:"modifiers.ctrl",type:ps},{name:"modifiers.alt",type:ps},{name:"modifiers.shift",type:ps},{name:"modifiers.meta",type:ps}])},Ds);function Ds(t,e){var n=bs.call(this)||this;return n.modifiers={ctrl:!1,alt:!1,shift:!1,meta:!1},n._assignFrom(t,e),n}var As,Rs,Ps,Ms,Ns,ks,Ls=(i(Fs,As=xs),Fs.prototype._getAssignableProperties=function(){return As.prototype._getAssignableProperties.call(this).concat([{name:"caretPos",type:fs}])},Fs);function Fs(t,e){var n=As.call(this)||this;return n.caretPos=null,n._assignFrom(t,e),n}function Os(t,e){var n=Rs.call(this)||this;return n.speed=null,n.minMovingTime=null,n.holdLeftButton=!1,n.skipScrolling=!1,n.skipDefaultDragBehavior=!1,n._assignFrom(t,e),n}function Us(t,e){var n=Ps.call(this)||this;return n.replace=!1,n.paste=!1,n._assignFrom(t,e),n}function Gs(t,e){var n=Ms.call(this,t,e)||this;return n.destinationOffsetX=null,n.destinationOffsetY=null,n._assignFrom(t,e),n}function Hs(t,e){var n=Ns.call(this)||this;return n.portraitOrientation=!1,n._assignFrom(t,e),n}function Bs(t,e){var n=ks.call(this)||this;return n.timeout=void 0,n.allowUnawaitedPromise=!1,n._assignFrom(t,e),n}function Vs(t){return t.top!==t}i(Os,Rs=xs),Os.prototype._getAssignableProperties=function(){return Rs.prototype._getAssignableProperties.call(this).concat([{name:"speed"},{name:"minMovingTime"},{name:"holdLeftButton"},{name:"skipScrolling",type:ps},{name:"skipDefaultDragBehavior",type:ps}])},i(Us,Ps=Ls),Us.prototype._getAssignableProperties=function(){return Ps.prototype._getAssignableProperties.call(this).concat([{name:"replace",type:ps},{name:"paste",type:ps}])},i(Gs,Ms=xs),Gs.prototype._getAssignableProperties=function(){return Ms.prototype._getAssignableProperties.call(this).concat([{name:"destinationOffsetX",type:hs},{name:"destinationOffsetY",type:hs}])},i(Hs,Ns=ir),Hs.prototype._getAssignableProperties=function(){return[{name:"portraitOrientation",type:ps}]},i(Bs,ks=ir),Bs.prototype._getAssignableProperties=function(){return[{name:"timeout",type:fs},{name:"allowUnawaitedPromise",type:ps}]};var zs=c.eventSandbox.message,js="driver|browser-manipulation|request",Xs="driver|browser-manipulation|response";zs.on(zs.SERVICE_MSG_RECEIVED_EVENT,function(e){var t,n,r,i,o;e.message.cmd===js&&(t=y.domUtils.findIframeByWindow(e.source),r=(n=e.message).command,(i=n.cropDimensions)&&(r.options=new Ws({crop:i,includePaddings:!1})),(o=new qs(r)).element=t,o.execute().then(function(t){return zs.sendServiceMsg({cmd:Xs,result:t},e.source)}))});var qs=(Ys.prototype._getAbsoluteCropValues=function(){var t=this.element.getBoundingClientRect(),e=t.top,n=t.left;n+=this.command.options.originOffset.x,e+=this.command.options.originOffset.y;var r=n+this.command.options.crop.right,i=e+this.command.options.crop.bottom;return{top:e+=this.command.options.crop.top,left:n+=this.command.options.crop.left,bottom:i,right:r}},Ys.prototype._createManipulationReadyMessage=function(){var t=Ya.devicePixelRatio||1,e={cmd:h.readyForBrowserManipulation,pageDimensions:{dpr:t,innerWidth:Ya.innerWidth,innerHeight:Ya.innerHeight,documentWidth:Ka.documentElement.clientWidth,documentHeight:Ka.documentElement.clientHeight,bodyWidth:Ka.body.clientWidth,bodyHeight:Ka.body.clientHeight},disableResending:!0};return this.command.type===f.takeElementScreenshot&&(e.cropDimensions=this._getAbsoluteCropValues()),e},Ys.prototype._runScrollBeforeScreenshot=function(){var i=this;return c.Promise.resolve().then(function(){if(i.element||!i.command.selector)return c.Promise.resolve();var t=i.command.selector.timeout,e="number"==typeof t?t:i.globalSelectorTimeout;return i.statusBar.showWaitingElementStatus(e),Jo([$o(i.command.selector)],i.globalSelectorTimeout).then(function(t){i.statusBar.hideWaitingElementStatus(),i.element=t[0]}).catch(function(t){throw i.statusBar.hideWaitingElementStatus(),t})}).then(function(){!function(t,e){var n=t.getBoundingClientRect(),r={left:n.left,right:n.right,top:n.top,bottom:n.bottom},i=y.styleUtils.getElementMargin(t),o=y.styleUtils.getElementPadding(t),s=y.styleUtils.getBordersWidth(t);e.originOffset={x:0,y:0};var a=r.left+t.scrollWidth+s.left+s.right,c=r.top+t.scrollHeight+s.top+s.bottom;r.right=Math.max(r.right,a),r.bottom=Math.max(r.bottom,c),e.includeBorders&&e.includePaddings?e.includeMargins&&(e.originOffset.x-=i.left,e.originOffset.y-=i.top,r.left-=i.left,r.top-=i.top,r.right+=i.right,r.bottom+=i.bottom):(e.originOffset.x+=s.left,e.originOffset.y+=s.top,r.left+=s.left,r.top+=s.top,r.right-=s.right,r.bottom-=s.bottom,e.includePaddings||(e.originOffset.x+=o.left,e.originOffset.y+=o.top,r.left+=o.left,r.top+=o.top,r.right-=o.right,r.bottom-=o.bottom)),r.width=r.right-r.left,r.height=r.bottom-r.top;var l=is({min:e.crop.left,max:e.crop.right,length:e.crop.width},r.width),u=is({min:e.crop.top,max:e.crop.bottom,length:e.crop.height},r.height);if(e.crop.left=l.min,e.crop.right=l.max,e.crop.width=l.length,e.crop.top=u.min,e.crop.bottom=u.max,e.crop.height=u.length,e.crop.width<=0||e.crop.height<=0)throw new qe(e.crop.width,e.crop.height);var d=y.styleUtils.getViewportDimensions();(r.width>d.width||r.height>d.height)&&(e.scrollToCenter=!0);var h="number"==typeof e.scrollTargetX,f="number"==typeof e.scrollTargetY;h||(e.scrollTargetX=os(e.crop.left,e.crop.right,d.width)),f||(e.scrollTargetY=os(e.crop.top,e.crop.bottom,d.height));var p=_.getOffsetOptions(t,e.scrollTargetX,e.scrollTargetY),m=p.offsetX,g=p.offsetY;e.scrollTargetX=m,e.scrollTargetY=g;var w=!h||e.scrollTargetX>=e.crop.left&&e.scrollTargetX<=e.crop.right,v=!f||e.scrollTargetY>=e.crop.top&&e.scrollTargetY<=e.crop.bottom;if(!w||!v)throw new ze(w,v)}(i.element,i.command.options);var t=i.command.options,e=t.scrollTargetX,n=t.scrollTargetY,r=t.scrollToCenter;return new _.Scroll(i.element,new Is({offsetX:e,offsetY:n,scrollToCenter:r,skipParentFrames:!0})).run()})},Ys.prototype._hideUI=function(){return n.hide(),this.command.markData&&n.showScreenshotMark(this.command.markData),y.delay(500)},Ys.prototype._showUI=function(){this.command.markData&&n.hideScreenshotMark(),n.show()},Ys.prototype._requestManipulation=function(){if(!Vs(Ya))return c.transport.queuedAsyncServiceMsg(this._createManipulationReadyMessage());var t=this._getAbsoluteCropValues();return y.sendRequestToFrame({cmd:js,command:this.command,cropDimensions:t},Xs,Ya.parent).then(function(t){if(!t.result)return{result:null};var e=t.result,n=e.result,r=e.executionError;if(r)throw r;return{result:n}})},Ys.prototype._runManipulation=function(){var r=this,i=null;return c.Promise.resolve().then(function(){return r.command.type!==f.takeElementScreenshot?c.Promise.resolve():(y.scrollController.stopPropagation(),r._runScrollBeforeScreenshot())}).then(function(){return Vs(Ya)?c.Promise.resolve():r._hideUI()}).then(function(){return r._requestManipulation()}).then(function(t){var e=t.result,n=t.error;if(n)throw n;return y.scrollController.enablePropagation(),i=e,Vs(Ya)||r._showUI(),y.delay(200)}).then(function(){return new cr({isCommandResult:!0,result:i})}).catch(function(t){return y.scrollController.enablePropagation(),new cr({isCommandResult:!0,executionError:t})})},Ys.prototype.execute=function(){var t=this;return Wo(function(){return t._runManipulation()}).barriersPromise},Ys);function Ys(t,e,n){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.element=null}var Ks=o.Promise,Js=($s.prototype.setAsMaster=function(t){return go(new Yi(t),this.driverWindow,wo,hn)},$s.prototype.closeAllChildWindows=function(){return go(new $i,this.driverWindow,wo,mn)},$s.prototype.findChildWindows=function(t,e){return go(new e(t),this.driverWindow,wo,hn)},$s.prototype.startToRestore=function(){return go(new to,this.driverWindow,wo,hn)},$s);function $s(t,e){this.driverWindow=t,this.windowId=e}var Qs=(Zs.prototype._getTopOpenedWindow=function(t){for(var e=t;e.opener;)e=e.opener;return e.top},Zs.prototype._setAsMaster=function(t,e){return go(new Yi(e),t,wo,hn)},Zs.prototype.getTopOpenedWindow=function(){return this._getTopOpenedWindow(this.currentDriverWindow)},Zs.prototype.setTopOpenedWindowAsMaster=function(){var t=this._getTopOpenedWindow(this.currentDriverWindow);return this._setAsMaster(t)},Zs.prototype.setParentWindowAsMaster=function(t){void 0===t&&(t={});var e=this.currentDriverWindow.opener;return this._setAsMaster(e,t.finalizePendingCommand)},Zs.prototype.restoreChild=function(r){return s(this,void 0,void 0,function(){var e,n;return l(this,function(t){return e=new ro(r),n=this.currentDriverWindow.opener,go(e,n,wo,hn),[2]})})},Zs);function Zs(t){this.currentDriverWindow=t}var ta,ea="master",na="replica",ra=o.settings,ia=o.transport,oa=o.Promise,sa=o.eventSandbox.message,aa=o.storages,ca=o.nativeMethods,la=ca.date,ua=o.eventSandbox.listeners,da="testcafe|driver|test-done-sent-flag",ha="testcafe|driver|pending-status",fa="testcafe|driver|executing-client-function-descriptor",pa="testcafe|driver|selector-execution-start-time",ma="testcafe|driver|pending-page-error",ga="testcafe|driver|active-iframe-selector",wa="testcafe|driver|test-speed",va="testcafe|driver|assertion-retries-timeout",ya="testcafe|driver|assertion-retries-start-time",_a="testcafe|driver|console-messages",Ca="testcafe|driver|pending-child-window-count",Ia={NotLoadedError:Ze,NotFoundError:oe,IsInvisibleError:ce},Ea={NotLoadedError:nn,NotFoundError:Hn,IsInvisibleError:zn},Sa=Math.pow(2,31)-1,Wa="status-with-command-result-event",Ta="empty-command-event",ba="child-window-closed",xa=(i(Da,ta=y.serviceUtils.EventEmitter),Da.prototype._isOpenedInIframe=function(){var t=Ya.opener;return t&&t.top&&t.top!==t},Object.defineProperty(Da.prototype,"speed",{get:function(){return this.contextStorage.getItem(wa)},set:function(t){this.contextStorage.setItem(wa,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Da.prototype,"consoleMessages",{get:function(){return new nr(this.contextStorage.getItem(_a))},set:function(t){return this.contextStorage.setItem(_a,t?t.getCopy():null)},enumerable:!1,configurable:!0}),Da.prototype._getReadyPromise=function(){return s(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,y.eventUtils.documentReady(this.pageLoadTimeout)];case 1:return t.sent(),[4,this.pageInitialRequestBarrier.wait(!0)];case 2:return t.sent(),[2]}})})},Da.prototype._hasPendingActionFlags=function(t){return t.getItem(this.COMMAND_EXECUTING_FLAG)||t.getItem(this.EXECUTING_IN_IFRAME_FLAG)},Da.prototype._getCurrentWindowId=function(){var t=Ya.location.toString(),e=o.utils.url.parseProxyUrl(t);return e&&e.windowId||null},Da.prototype._onJsError=function(t){if(this.skipJsErrors||this.contextStorage.getItem(da))return oa.resolve();var e=new Pt(t.stack,t.pageUrl);return this.contextStorage.getItem(ma)||this.contextStorage.setItem(ma,e),null},Da.prototype._unlockPageAfterTestIsDone=function(){return y.disableRealEventsPreventing(),oa.resolve()},Da.prototype._failIfClientCodeExecutionIsInterrupted=function(){var t=this.contextStorage.getItem(fa);return!!t&&(this._onReady(new cr({isCommandResult:!0,executionError:new wt(t.instantiationCallsiteName)})),!0)},Da.prototype.onCustomClientScriptError=function(t,e){var n=e?new zt(t,e):new Ht(t);this.contextStorage.getItem(ma)||this.contextStorage.setItem(ma,n)},Da.prototype._addChildWindowDriverLink=function(t){var e=new Js(t.window,t.windowId);this.childWindowDriverLinks.push(e),this._ensureClosedChildWindowWatcher()},Da.prototype._ensureClosedChildWindowWatcher=function(){var e=this;this.checkClosedChildWindowIntervalId||(this.checkClosedChildWindowIntervalId=ca.setInterval.call(Ya,function(){var t=y.arrayUtils.find(e.childWindowDriverLinks,function(t){return t.driverWindow.closed});t&&(e.emit(ba),y.arrayUtils.remove(e.childWindowDriverLinks,t),t.ignoreMasterSwitching||e._setCurrentWindowAsMaster(),e.childWindowDriverLinks.length||(ca.clearInterval.call(Ya,e.checkClosedChildWindowIntervalId),delete e.checkClosedChildWindowIntervalId))},200))},Da.prototype._setAsMasterInProgressOrCompleted=function(){return this.setAsMasterInProgress||this.role===ea},Da.prototype._setCurrentWindowAsMaster=function(){var t=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,this._clearActiveChildIframeInfo(),oa.resolve().then(function(){return y.browser.setActiveWindowId(t.browserActiveWindowId,o.createNativeXHR,t.windowId)}).then(function(){t._startInternal({finalizePendingCommand:!0,isFirstRequestAfterWindowSwitching:!0}),t.setAsMasterInProgress=!1}).catch(function(){t._onReady(new cr({isCommandResult:!0,executionError:new hn}))}))},Da.prototype._onChildWindowOpened=function(t){this._addChildWindowDriverLink(t),this._switchToChildWindow(t.windowId)},Da.prototype._sendStartToRestoreCommand=function(){if(this.contextStorage){this._stopRespondToChildren=!0,this.contextStorage.setItem(Ca,this.childWindowDriverLinks.length);for(var t=0,e=this.childWindowDriverLinks;t<e.length;t++)e[t].startToRestore()}},Da.prototype._onFormSubmit=function(t){this.contextStorage&&this.contextStorage.getItem(da)&&(t.preventSubmit=!0)},Da.prototype._onConsoleMessage=function(t){var e=t.meth,n=t.line,r=this.consoleMessages;r.addMessage(e,n,this.windowId),this.consoleMessages=r},Da.prototype._addPendingErrorToStatus=function(t){var e=this.contextStorage.getItem(ma);e&&(this.contextStorage.setItem(ma,null),t.pageError=e)},Da.prototype._addUnexpectedDialogErrorToStatus=function(t){var e=this.nativeDialogsTracker.getUnexpectedDialogError();t.pageError=t.pageError||e},Da.prototype._addConsoleMessagesToStatus=function(t){t.consoleMessages=this.consoleMessages,this.consoleMessages=null},Da.prototype._addPendingWindowSwitchingStateToStatus=function(t){t.isPendingWindowSwitching=!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Da.prototype._sendStatusRequest=function(t){function e(){return y.getTimeLimitedPromise(ia.asyncServiceMsg(r),5e3)}function n(){return y.delay(300).then(e)}for(var r={cmd:h.ready,status:t,disableResending:!0,allowRejecting:!0},i=e(),o=0;o<d;o++)i=i.catch(n);return i},Da.prototype._sendStatus=function(t){var e=this;t.resent||(this._addPendingErrorToStatus(t),this._addUnexpectedDialogErrorToStatus(t),this._addConsoleMessagesToStatus(t),this._addPendingWindowSwitchingStateToStatus(t)),this.contextStorage.setItem(ha,t);var n=null;return y.pageUnloadBarrier.wait(0).then(function(){return e._sendStatusRequest(t)}).then(function(t){return n=t,y.pageUnloadBarrier.wait(0)}).then(function(){return e.contextStorage.setItem(ha,null),n})},Da.prototype._addChildIframeDriverLink=function(t,e){var n,r=this._getChildIframeDriverLinkByWindow(e);r||(n=this.testRunId+"-"+sr(),r=new yo(e,n),this.childIframeDriverLinks.push(r)),r.sendConfirmationMessage(t)},Da.prototype._getTargetWindowNotFoundResult=function(t,e){return oa.resolve({success:!1,errCode:t,errMsg:e})},Da.prototype._getChildWindowValidateResult=function(t){var e=t.find(function(t){return t.result.success});if(e)return e.result;var n=t.find(function(t){return t.result.errCode===nt||t.result.errCode===at});return(n=n||t.find(function(t){return!!t.result.errCode}))?{errCode:n.result.errCode}:void 0},Da.prototype._handleWindowValidation=function(n,r,i,o){return s(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return[4,this._validateWindow(n,r,i,o)];case 1:return e=t.sent(),vo({requestMsgId:n.id,window:r,result:e}),[2]}})})},Da.prototype._getWindowInfo=function(){var t=o.utils.url.parseProxyUrl(Ya.location.toString());return{id:this.windowId,title:Ka.title,url:t.destUrl}},Da.prototype._isTargetWindow=function(t){return t.windowId===this.windowId},Da.prototype._validateWindow=function(r,t,i,o){return s(this,void 0,void 0,function(){var e,n;return l(this,function(t){switch(t.label){case 0:return this._isTargetWindow(r)?[2,i()]:this.childWindowDriverLinks.length?(e=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(r,o)}),[4,oa.all(e)]):[2,this._getTargetWindowNotFoundResult(rt)];case 1:return n=t.sent(),[2,this._getChildWindowValidateResult(n)]}})})},Da._createWindowValidationError=function(t){var e=t.errCode;return new(e===nt?vn:e===at?In:Tn)},Da.prototype._getCloseWindowFoundResult=function(){return this.parentWindowDriverLink?this.childWindowDriverLinks.length?oa.resolve({success:!1,errCode:nt}):oa.resolve({success:!0}):oa.resolve({success:!1,errCode:at})},Da.prototype._handleCloseWindowValidation=function(t,e){var n=this;return this._handleWindowValidation(t,e,function(){return n._getCloseWindowFoundResult()},Ci)},Da.prototype._handleSwitchToWindowValidation=function(t,e){return this._handleWindowValidation(t,e,function(){return oa.resolve({success:!0})},Si)},Da.prototype._handleCloseWindow=function(e,n){return s(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,this._closeWindow(e,n)];case 1:return t.sent(),vo({requestMsgId:e.id,window:n}),[2]}})})},Da.prototype._closeWindowAndWait=function(t,e){var n=this._createWaitForEventPromise(ba,2e3);return t.ignoreMasterSwitching=!e.isCurrentWindow,t.driverWindow.close(),n},Da.prototype._closeWindow=function(e){if(!this.childWindowDriverLinks.length)return oa.resolve();var t=this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId});if(t)return this._closeWindowAndWait(t,e);var n=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,Ai)});return oa.all(n)},Da.prototype._getWindows=function(){return s(this,void 0,void 0,function(){var e,n,r,i,o,s;return l(this,function(t){switch(t.label){case 0:return this.childWindowDriverLinks.length?(e=this.childWindowDriverLinks.map(function(t){return t.findChildWindows({},bi)}),[4,oa.all(e)]):[2,[this._getWindowInfo()]];case 1:for(n=t.sent(),r=[this._getWindowInfo()],i=0,o=n;i<o.length;i++)s=o[i],Array.isArray(s.result)&&(r=r.concat(s.result));return[2,r]}})})},Da.prototype._handleGetWindows=function(n,r){return s(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return[4,this._getWindows(n,r)];case 1:return e=t.sent(),vo({requestMsgId:n.id,window:r,result:e}),[2]}})})},Da.prototype._handleSwitchToWindow=function(e,n){return s(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,this._switchToWindow(e)];case 1:return t.sent(),vo({requestMsgId:e.id,window:n}),[2]}})})},Da.prototype._switchToWindow=function(e){var t=this;return this._isTargetWindow(e)?oa.resolve().then(function(){t._setCurrentWindowAsMaster()}):this.childWindowDriverLinks.length?oa.all(this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,Mi)})):oa.resolve()},Da.prototype._handleSetAsMasterMessage=function(t,e){var n=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,vo({requestMsgId:t.id,window:e}),oa.resolve().then(function(){return y.browser.setActiveWindowId(n.browserActiveWindowId,o.createNativeXHR,n.windowId)}).then(function(){n._startInternal({finalizePendingCommand:t.finalizePendingCommand,result:{id:n.windowId}}),n.setAsMasterInProgress=!1}).catch(function(){n._onReady(new cr({isCommandResult:!0,executionError:new hn}))}))},Da.prototype._handleCloseAllWindowsMessage=function(t,e){var n=this;this._closeAllChildWindows().then(function(){vo({requestMsgId:t.id,window:e})}).catch(function(){n._onReady(new cr({isCommandResult:!0,executionError:new mn}))})},Da.prototype._handleStartToRestoreChildLinkMessage=function(){this.parentWindowDriverLink.restoreChild(this._getCurrentWindowId())},Da.prototype._handleRestoreChildLink=function(t,e){this._stopRespondToChildren||(this._addChildWindowDriverLink({window:e,windowId:t.windowId}),this.childWindowDriverLinks.length===this.contextStorage.getItem(Ca)&&this._restoreChildWindowsPromiseResolver&&(this._restoreChildWindowsPromiseResolver(),delete this._restoreChildWindowsPromiseResolver,this.contextStorage.setItem(Ca,0)),vo({requestMsgId:t.id,window:e}))},Da.prototype._handleChildWindowIsOpenedInIFrame=function(){var e=this;this._pendingChildWindowInIFrame=new oa(function(t){e._resolvePendingChildWindowInIframe=t})},Da.prototype._handleChildWindowIsLoadedInIFrame=function(e,t){vo({requestMsgId:e.id,window:t}),this._resolvePendingChildWindowInIframe(),this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId})||this._onChildWindowOpened({window:t,windowId:e.windowId})},Da.prototype._initChildDriverListening=function(){var r=this;sa.on(sa.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message,n=t.source;switch(e.type){case ni:r._addChildIframeDriverLink(e.id,n);break;case wi:r._handleChildWindowIsOpenedInIFrame(e,n);break;case gi:r._handleChildWindowIsLoadedInIFrame(e,n);break;case hi:r._handleSetAsMasterMessage(e,n);break;case ri:r._handleSwitchToWindow(e,n);break;case ii:r._handleCloseWindow(e,n);break;case si:r._handleSwitchToWindowValidation(e,n);break;case oi:r._handleCloseWindowValidation(e,n);break;case ai:r._handleGetWindows(e,n);break;case fi:r._handleCloseAllWindowsMessage(e,n);break;case pi:r._handleStartToRestoreChildLinkMessage();break;case mi:r._handleRestoreChildLink(e,n)}})},Da.prototype._getChildIframeDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childIframeDriverLinks,function(t){return t.driverWindow===e})},Da.prototype._getChildWindowDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childWindowDriverLinks,function(t){return t.driverWindow===e})},Da.prototype._runInActiveIframe=function(t){var e=this,n=oa.resolve(),r=this.contextStorage.getItem(ga);!this.activeChildIframeDriverLink&&r&&(n=this._switchToIframe(r,Ea)),n.then(function(){return e.contextStorage.setItem(e.EXECUTING_IN_IFRAME_FLAG,!0),e.activeChildIframeDriverLink.executeCommand(t,e.speed)}).then(function(t){return e._onCommandExecutedInIframe(t)}).catch(function(t){return e._onCommandExecutedInIframe(new cr({isCommandResult:!0,executionError:t}))})},Da.prototype._onCommandExecutedInIframe=function(t){var e=this;this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1);var n=oa.resolve();this._pendingChildWindowInIFrame&&(n=this._pendingChildWindowInIFrame),n.then(function(){e._onReady(t)})},Da.prototype._ensureChildIframeDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildIframeDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},Da.prototype._ensureChildWindowDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildWindowDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},Da.prototype._switchToIframe=function(e,n){var t,r,i,o,s,a,c,l=this,u="number"==typeof e.timeout?e.timeout:this.selectorTimeout;return t=e,r=u,i=null,o=function(t){return new n.NotFoundError(t)},s=function(){return new n.IsInvisibleError},a=this.statusBar,c=new jo(t,r,i,o,s),a.showWaitingElementStatus(c.timeout),c.getResult().then(function(t){return a.hideWaitingElementStatus(!!t).then(function(){return t})}).catch(function(t){return a.hideWaitingElementStatus(!1).then(function(){throw t})}).then(function(t){if(!y.domUtils.isIframeElement(t))throw new Je;return l._ensureChildIframeDriverLink(ca.contentWindowGetter.call(t),n.NotLoadedError,u)}).then(function(t){t.availabilityTimeout=u,l.activeChildIframeDriverLink=t,l.contextStorage.setItem(ga,e)})},Da.prototype._createWaitForEventPromise=function(e,n){var r=this,i=null,t=new oa(function(t){ca.setTimeout.call(Ya,function(){r.off(e,i),t()},n)}),o=new oa(function(t){i=function(){this.off(e,i),t()},r.on(e,i)});return oa.race([t,o])},Da.prototype._waitForCurrentCommandCompletion=function(){return this.contextStorage.getItem(this.COMMAND_EXECUTING_FLAG)?this._createWaitForEventPromise(Wa,Sa):oa.resolve()},Da.prototype._waitForEmptyCommand=function(){return this._createWaitForEventPromise(Ta,3e4)},Da.prototype._abortSwitchingToChildWindowIfItClosed=function(){if(this.activeChildWindowDriverLink.driverWindow.closed)throw y.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),this.activeChildWindowDriverLink=null,new kn},Da.prototype._switchToChildWindow=function(t){var e=this;this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0);var n=this.contextStorage.getItem(this.WINDOW_COMMAND_API_CALL_FLAG);return function(e,t){if("string"!=typeof e)return Ks.resolve(null);var n=y.arrayUtils.find(t,function(t){return t.windowId===e});if(n)return Ks.resolve(n);var r=new sn;return Ks.reject(r)}(t,this.childWindowDriverLinks).then(function(t){return e._ensureChildWindowDriverLink(t.driverWindow,ln,e.childWindowReadyTimeout)}).then(function(t){return e.activeChildWindowDriverLink=t,e._waitForCurrentCommandCompletion()}).then(function(){return n?void 0:e._waitForEmptyCommand()}).then(function(){return e._abortSwitchingToChildWindowIfItClosed(),e._stopInternal(),e.activeChildWindowDriverLink.setAsMaster(n)}).then(function(){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(t){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1),t instanceof kn?e._onReady(new cr):e._onReady(new cr({isCommandResult:!0,executionError:new hn}))})},Da.prototype._switchToTopParentWindow=function(){var t=this.parentWindowDriverLink.setTopOpenedWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(t)},Da.prototype._switchToParentWindow=function(t){void 0===t&&(t={});var e=this.parentWindowDriverLink.setParentWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(e,t)},Da.prototype._switchToParentWindowInternal=function(t,e){var n=this;return void 0===e&&(e={}),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),oa.resolve().then(function(){return n._stopInternal(),t(e)}).then(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1),n._onReady(new cr({isCommandResult:!0,executionError:new hn}))})},Da.prototype._switchToMainWindow=function(t){this.activeChildIframeDriverLink&&this.activeChildIframeDriverLink.executeCommand(t),this._clearActiveChildIframeInfo()},Da.prototype._clearActiveChildIframeInfo=function(){this.contextStorage.setItem(ga,null),this.activeChildIframeDriverLink=null},Da.prototype._setNativeDialogHandlerInIframes=function(t){for(var e=new ji(t),n=0;n<this.childIframeDriverLinks.length;n++)sa.sendServiceMsg(e,this.childIframeDriverLinks[n].driverWindow)},Da.prototype._onActionCommand=function(t){var e,n,r,i,o=this,s=(e=t,n=this.selectorTimeout,r=this.statusBar,i=this.speed,new es(e,n,r,i).execute()),a=s.startPromise,c=s.completionPromise;a.then(function(){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!0)}),c.then(function(t){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(t)})},Da.prototype._onSetNativeDialogHandlerCommand=function(t){this.nativeDialogsTracker.setHandler(t.dialogHandler),this._setNativeDialogHandlerInIframes(t.dialogHandler),this._onReady(new cr({isCommandResult:!0}))},Da.prototype._onGetNativeDialogHistoryCommand=function(){this._onReady(new cr({isCommandResult:!0,result:this.nativeDialogsTracker.appearedDialogs}))},Da.prototype._onGetBrowserConsoleMessagesCommand=function(){this._onReady(new cr({isCommandResult:!0}))},Da.prototype._onNavigateToCommand=function(t){var e=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),function(r){return s(this,void 0,void 0,function(){var e,n;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=new y.RequestBarrier,c.navigateTo(r.url,r.forceReload),[4,c.Promise.all([e.wait(),y.pageUnloadBarrier.wait()])];case 1:return t.sent(),[2,new cr({isCommandResult:!0})];case 2:return n=t.sent(),[2,new cr({isCommandResult:!0,executionError:n})];case 3:return[2]}})})}(t).then(function(t){return e.contextStorage.setItem(e.COMMAND_EXECUTING_FLAG,!1),e._onReady(t)})},Da.prototype._onExecuteClientFunctionCommand=function(t){var e=this;this.contextStorage.setItem(fa,{instantiationCallsiteName:t.instantiationCallsiteName}),new Gr(t).getResultDriverStatus().then(function(t){e.contextStorage.setItem(fa,null),e._onReady(t)})},Da.prototype._onExecuteSelectorCommand=function(t){var e,n,r,i,o,s,a,c=this,l=this.contextStorage.getItem(pa)||new la,u=t.needError?function(t){return new Dt(null,t)}:null;e=t,n=this.selectorTimeout,r=l,o=i=u,s=this.statusBar,a=new jo(e,n,r,i,o),s.showWaitingElementStatus(a.timeout),a.getResultDriverStatus().then(function(t){return s.hideWaitingElementStatus(!!t.result).then(function(){return t})}).then(function(t){c.contextStorage.setItem(pa,null),c._onReady(t)})},Da.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t),this._onReady(new cr({isCommandResult:!0}))},Da.prototype._onSwitchToIframeCommand=function(t){var e=this;this._switchToIframe(t.selector,Ia).then(function(){return e._onReady(new cr({isCommandResult:!0}))}).catch(function(t){return e._onReady(new cr({isCommandResult:!0,executionError:t}))})},Da.prototype._onWindowOpenCommand=function(t){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!0),Ya.open(t.url)},Da.prototype._onWindowCloseCommand=function(a){return s(this,void 0,void 0,function(){var e,n,r,i,o,s;return l(this,function(t){switch(t.label){case 0:e=this._getTopOpenedWindow(),n=a.windowId||this.windowId,r=n===this.windowId,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this._validateChildWindowCloseCommandExists(n,e)];case 2:if(i=t.sent(),!(o=i.result).success)throw Da._createWindowValidationError(o);return[4,go(new Ai({windowId:n,isCurrentWindow:r}),e,wo,hn)];case 3:return t.sent(),r||this._onReady(new cr({isCommandResult:!0})),[3,5];case 4:return s=t.sent(),this._onReady(new cr({isCommandResult:!0,executionError:s})),[3,5];case 5:return[2]}})})},Da.prototype._onGetCurrentWindowCommand=function(){this._onReady(new cr({isCommandResult:!0,result:{id:this.windowId}}))},Da.prototype._onGetWindowsCommand=function(){return s(this,void 0,void 0,function(){var e,n;return l(this,function(t){switch(t.label){case 0:return e=this._getTopOpenedWindow(),[4,go(new bi,e,wo,hn)];case 1:return n=t.sent(),this._onReady(new cr({isCommandResult:!0,result:n.result})),[2]}})})},Da.prototype._validateChildWindowCloseCommandExists=function(t,e){return go(new Ci({windowId:t}),e,wo,hn)},Da.prototype._validateChildWindowSwitchToWindowCommandExists=function(t,e){var n=t.windowId,r=t.fn;return go(new Si({windowId:n,fn:r}),e,wo,hn)},Da.prototype._getTopOpenedWindow=function(){var t;return((null===(t=this.parentWindowDriverLink)||void 0===t?void 0:t.getTopOpenedWindow())||Ya).top},Da.prototype._onSwitchToWindow=function(i,o){return s(this,void 0,void 0,function(){var e,n,r;return l(this,function(t){switch(t.label){case 0:return e=this._getTopOpenedWindow(),[4,this._validateChildWindowSwitchToWindowCommandExists({windowId:i.windowId,fn:i.findWindow},e)];case 1:return n=t.sent(),(r=n.result).success?(this._stopInternal(),go(new Mi({windowId:i.windowId,fn:i.findWindow}),e,wo,hn)):this._onReady(new cr({isCommandResult:!0,executionError:o||Da._createWindowValidationError(r)})),[2]}})})},Da.prototype._restoreChildWindowLinks=function(){return s(this,void 0,void 0,function(){var e,n=this;return l(this,function(t){switch(t.label){case 0:if(!this.contextStorage.getItem(Ca))return[2];e=new oa(function(t){n._restoreChildWindowsPromiseResolver=t}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,y.getTimeLimitedPromise(e,3e4)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this._onReady(new cr({isCommandResult:!0,executionError:new On})),[3,4];case 4:return[2]}})})},Da.prototype._onSwitchToPreviousWindow=function(t){this._onSwitchToWindow(t,new Pn)},Da.prototype._onSwitchToParentWindow=function(){this.parentWindowDriverLink?this._switchToParentWindow({finalizePendingCommand:!0}):this._onReady(new cr({isCommandResult:!0,executionError:new Dn}))},Da.prototype._onBrowserManipulationCommand=function(t){var e,n,r,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),e=t,n=this.selectorTimeout,r=this.statusBar,new qs(e,n,r).execute().then(function(t){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(t)})},Da.prototype._onSetBreakpointCommand=function(t){var e=this;this.statusBar.showDebuggingStatus(t).then(function(t){return e._onReady(new cr({isCommandResult:!0,result:t}))})},Da.prototype._onSetTestSpeedCommand=function(t){this.speed=t.speed,this._onReady(new cr({isCommandResult:!0}))},Da.prototype._onShowAssertionRetriesStatusCommand=function(t){this.contextStorage.setItem(va,t.timeout),this.contextStorage.setItem(ya,ca.dateNow()),this.statusBar.showWaitingAssertionRetriesStatus(t.timeout),this._onReady(new cr({isCommandResult:!0}))},Da.prototype._onHideAssertionRetriesStatusCommand=function(t){var e=this;this.contextStorage.setItem(va,null),this.contextStorage.setItem(ya,null),this.statusBar.hideWaitingAssertionRetriesStatus(t.success).then(function(){return e._onReady(new cr({isCommandResult:!0}))})},Da.prototype._checkStatus=function(){var r=this;return y.browser.checkStatus(this.browserStatusDoneUrl,o.createNativeXHR,{manualRedirect:!0}).then(function(t){var e=t.command,n=t.redirecting;n&&e.url.indexOf(r.testRunId)<0?(aa.clear(),aa.lock()):r.contextStorage.setItem(da,!1),n?y.browser.redirect(e):r._onReady({isCommandResult:!1})}).catch(function(){return y.delay(1e3)})},Da.prototype._onCustomCommand=function(t){var e=this;(0,this.customCommandHandlers[t.type].handler)(t).then(function(t){e._onReady(new cr({isCommandResult:!0,result:t}))})},Da.prototype._closeAllChildWindows=function(){var t=this;return this.childWindowDriverLinks.length?oa.all(this.childWindowDriverLinks.map(function(t){return t.closeAllChildWindows()})).then(function(){ca.arrayForEach.call(t.childWindowDriverLinks,function(t){t.driverWindow.close()})}):oa.resolve()},Da.prototype._onTestDone=function(t){var e=this;this.contextStorage.setItem(da,!0),this.parentWindowDriverLink?this._switchToTopParentWindow():this._closeAllChildWindows().then(function(){return e._sendStatus(t)}).then(function(){e._checkStatus()}).catch(function(){e._onReady(new cr({isCommandResult:!0,executionError:mn}))})},Da.prototype._onBackupStoragesCommand=function(){this._onReady(new cr({isCommandResult:!0,result:aa.backup()}))},Da.prototype._isStatusWithCommandResultInPendingWindowSwitchingMode=function(t){return t.isCommandResult&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Da.prototype._isEmptyCommandInPendingWindowSwitchingMode=function(t){return!t&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Da.prototype._onReady=function(t){var e=this;this._isStatusWithCommandResultInPendingWindowSwitchingMode(t)&&this.emit(Wa),this._sendStatus(t).then(function(t){if(t)e._onCommand(t);else{if(e._isEmptyCommandInPendingWindowSwitchingMode(t))return void e.emit(Ta);e._onReady(new cr)}})},Da.prototype._executeCommand=function(t){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!1),this.customCommandHandlers[t.type]?this._onCustomCommand(t):t.type===f.testDone?this._onTestDone(new cr({isCommandResult:!0})):t.type===f.setBreakpoint?this._onSetBreakpointCommand(t.isTestError):t.type===f.switchToMainWindow?this._onSwitchToMainWindowCommand(t):t.type===f.switchToIframe?this._onSwitchToIframeCommand(t):t.type===f.openWindow?this._onWindowOpenCommand(t):t.type===f.closeWindow?this._onWindowCloseCommand(t):t.type===f.getCurrentWindow?this._onGetCurrentWindowCommand(t):t.type===f.getCurrentWindows?this._onGetWindowsCommand():t.type===f.switchToWindow?this._onSwitchToWindow(t):t.type===f.switchToPreviousWindow?this._onSwitchToPreviousWindow(t):t.type===f.switchToParentWindow?this._onSwitchToParentWindow():dt(t)?this._onBrowserManipulationCommand(t):t.type===f.executeClientFunction?this._onExecuteClientFunctionCommand(t):t.type===f.executeSelector?this._onExecuteSelectorCommand(t):t.type===f.navigateTo?this._onNavigateToCommand(t):t.type===f.setNativeDialogHandler?this._onSetNativeDialogHandlerCommand(t):t.type===f.getNativeDialogHistory?this._onGetNativeDialogHistoryCommand(t):t.type===f.getBrowserConsoleMessages?this._onGetBrowserConsoleMessagesCommand(t):t.type===f.setTestSpeed?this._onSetTestSpeedCommand(t):t.type===f.showAssertionRetriesStatus?this._onShowAssertionRetriesStatusCommand(t):t.type===f.hideAssertionRetriesStatus?this._onHideAssertionRetriesStatusCommand(t):t.type===f.backupStorages?this._onBackupStoragesCommand():this._onActionCommand(t)},Da.prototype._isExecutableInTopWindowOnly=function(t){if((e=t).type===f.testDone||e.type===f.switchToMainWindow||e.type===f.setNativeDialogHandler||e.type===f.getNativeDialogHistory||e.type===f.setTestSpeed||e.type===f.showAssertionRetriesStatus||e.type===f.hideAssertionRetriesStatus||e.type===f.setBreakpoint||dt(e)&&e.type!==f.takeElementScreenshot)return!0;var e,n=this.customCommandHandlers[t.type];return t.forceExecutionInTopWindowOnly||n&&n.isExecutableInTopWindowOnly},Da.prototype._onCommand=function(n){var r=this;this.readyPromise.then(function(){var t,e=lt(n);r.contextStorage.getItem(ma)&&e?r._onReady(new cr({isCommandResult:!0})):(t=r.activeChildIframeDriverLink||r.contextStorage.getItem(ga),r._isExecutableInTopWindowOnly(n)||!t?r._executeCommand(n):r._runInActiveIframe(n))})},Da.prototype.setCustomCommandHandlers=function(t,e,n){this.customCommandHandlers[t]={isExecutableInTopWindowOnly:n,handler:e}},Da.prototype._startInternal=function(t){this.role=ea,y.browser.startHeartbeat(this.heartbeatUrl,o.createNativeXHR),this._setupAssertionRetryIndication(),this._startCommandsProcessing(t)},Da.prototype._stopInternal=function(){this.role=na,y.browser.stopHeartbeat(),_.cursor.hide()},Da.prototype._setupAssertionRetryIndication=function(){var n=this;this.readyPromise.then(function(){n.statusBar.hidePageLoadingStatus();var t,e=n.contextStorage.getItem(va);e&&(t=n.contextStorage.getItem(ya),0<e-(new la-t)&&n.statusBar.showWaitingAssertionRetriesStatus(e,t))})},Da.prototype._startCommandsProcessing=function(t){void 0===t&&(t={finalizePendingCommand:!1,isFirstRequestAfterWindowSwitching:!1,result:void 0});var e,n,r=this.contextStorage.getItem(ha);r&&(r.resent=!0),this.contextStorage.getItem(da)?r?this._onTestDone(r):this._checkStatus():this._failIfClientCodeExecutionIsInterrupted()||(e=t.finalizePendingCommand||this._hasPendingActionFlags(this.contextStorage),n=r||new cr({isCommandResult:e,isFirstRequestAfterWindowSwitching:t.isFirstRequestAfterWindowSwitching,result:t.result}),this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!1),this._onReady(n))},Da.prototype._initParentWindowLink=function(){Ya.opener&&Ya.opener!==Ya&&this.windowId&&(this.parentWindowDriverLink=new Qs(Ya))},Da.prototype._initConsoleMessages=function(){var t=this.consoleMessages;t.ensureMessageContainer(this.windowId),this.consoleMessages=t},Da.prototype._getDriverRole=function(){return s(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return this.windowId?[4,y.browser.getActiveWindowId(this.browserActiveWindowId,o.createNativeXHR)]:[2,ea];case 1:return[2,t.sent().activeWindowId===this.windowId?ea:na]}})})},Da.prototype._init=function(){this.contextStorage=new po(Ya,this.testRunId,this.windowId),this.nativeDialogsTracker=new Qr(this.contextStorage,this.dialogHandler),this.statusBar=new n.StatusBar(this.userAgent,this.fixtureName,this.testName,this.contextStorage),this.statusBar.on(this.statusBar.UNLOCK_PAGE_BTN_CLICK,y.disableRealEventsPreventing),this.speed=this.initialSpeed,this._initConsoleMessages(),this._initParentWindowLink(),this._isOpenedInIframe()&&go(new so(this.windowId),Ya.opener.top,wo,Tn)},Da.prototype._doFirstPageLoadSetup=function(){return s(this,void 0,void 0,function(){return l(this,function(t){return this.isFirstPageLoad&&this.canUseDefaultWindowActions,[2]})})},Da.prototype.start=function(){return s(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return this._init(),[4,this._doFirstPageLoadSetup()];case 1:return t.sent(),[4,this._restoreChildWindowLinks()];case 2:return t.sent(),[4,this._getDriverRole()];case 3:return e=t.sent(),this.role===ea||e===ea&&this._startInternal(),[2]}})})},Da);function Da(t,e,n,r){var i=ta.call(this)||this;return i.COMMAND_EXECUTING_FLAG="testcafe|driver|command-executing-flag",i.EXECUTING_IN_IFRAME_FLAG="testcafe|driver|executing-in-iframe-flag",i.PENDING_WINDOW_SWITCHING_FLAG="testcafe|driver|pending-window-switching-flag",i.WINDOW_COMMAND_API_CALL_FLAG="testcafe|driver|window-command-api-flag",i.testRunId=t,i.heartbeatUrl=e.heartbeat,i.browserStatusUrl=e.status,i.browserStatusDoneUrl=e.statusDone,i.browserActiveWindowId=e.activeWindowId,i.userAgent=n.userAgent,i.fixtureName=n.fixtureName,i.testName=n.testName,i.selectorTimeout=r.selectorTimeout,i.pageLoadTimeout=r.pageLoadTimeout,i.childWindowReadyTimeout=r.childWindowReadyTimeout,i.initialSpeed=r.speed,i.skipJsErrors=r.skipJsErrors,i.dialogHandler=r.dialogHandler,i.canUseDefaultWindowActions=r.canUseDefaultWindowActions,i.isFirstPageLoad=ra.get().isFirstPageLoad,i.customCommandHandlers={},i.contextStorage=null,i.nativeDialogsTracker=null,i.childIframeDriverLinks=[],i.activeChildIframeDriverLink=null,i.childWindowDriverLinks=[],i.parentWindowDriverLink=null,i.statusBar=null,i.windowId=i._getCurrentWindowId(),i.role=na,i.setAsMasterInProgress=!1,i.checkClosedChildWindowIntervalId=null,i.pageInitialRequestBarrier=new y.RequestBarrier,i.readyPromise=i._getReadyPromise(),i._initChildDriverListening(),y.pageUnloadBarrier.init(),y.preventRealEvents(),o.on(o.EVENTS.uncaughtJsError,function(t){return i._onJsError(t)}),o.on(o.EVENTS.unhandledRejection,function(t){return i._onJsError(t)}),o.on(o.EVENTS.consoleMethCalled,function(t){return i._onConsoleMessage(t)}),o.on(o.EVENTS.beforeFormSubmit,function(t){return i._onFormSubmit(t)}),o.on(o.EVENTS.windowOpened,function(t){return i._onChildWindowOpened(t)}),i.setCustomCommandHandlers(f.unlockPage,function(){return i._unlockPageAfterTestIsDone()}),ua.addInternalEventBeforeListener(Ya,["beforeunload"],function(){i._sendStartToRestoreCommand()}),i}var Aa=(Ra.prototype.establishConnection=function(){return go(new vi,this.driverWindow,5e3,nn).then(function(t){return t.result.id})},Ra.prototype.sendConfirmationMessage=function(t){vo({requestMsgId:t,window:this.driverWindow})},Ra.prototype.onCommandExecuted=function(t){var e=new Li(t);c.eventSandbox.message.sendServiceMsg(e,this.driverWindow)},Ra);function Ra(t){this.driverWindow=t}var Pa,Ma=o.eventSandbox.message,Na=(i(ka,Pa=Qr),ka.prototype._defaultDialogHandler=function(t){Ma.sendServiceMsg({type:Vr,dialogType:t,url:Qr._getPageUrl()},Ya.top)},ka.prototype._addAppearedDialogs=function(t,e){Ma.sendServiceMsg({type:Br,dialogType:t,text:e,url:Qr._getPageUrl()},Ya.top)},ka.prototype._onHandlerError=function(t,e){Ma.sendServiceMsg({type:zr,dialogType:t,message:e,url:Qr._getPageUrl()},Ya.top)},ka);function ka(t){return Pa.call(this,null,t)||this}var La,Fa=c.eventSandbox.message,Oa=(i(Ua,La=xa),Ua.prototype._onJsError=function(){},Ua.prototype._onConsoleMessage=function(){},Ua.prototype._onChildWindowOpened=function(){Fa.sendServiceMsg(new lo,Ya.top)},Ua.prototype._initParentDriverListening=function(){var n=this;c.eventSandbox.message.on(c.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;y.pageUnloadBarrier.wait(0).then(function(){if(e.type===li){if(n.lastParentDriverMessageId===e.id)return;n.lastParentDriverMessageId=e.id,n.readyPromise.then(function(){n.speed=e.testSpeed,n.parentDriverLink.sendConfirmationMessage(e.id),n._onCommand(e.command)})}e.type===di&&(n.nativeDialogsTracker.setHandler(e.dialogHandler),n._setNativeDialogHandlerInIframes(e.dialogHandler))})})},Ua.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t)},Ua.prototype._onReady=function(t){this.parentDriverLink.onCommandExecuted(t)},Ua.prototype.start=function(){var e=this;this.nativeDialogsTracker=new Na(this.dialogHandler),this.statusBar=new n.IframeStatusBar;var t=this.parentDriverLink.establishConnection().then(function(t){e.contextStorage=new po(Ya,t,e.windowId),e._failIfClientCodeExecutionIsInterrupted()||(e.contextStorage.getItem(e.COMMAND_EXECUTING_FLAG)||e.contextStorage.getItem(e.EXECUTING_IN_IFRAME_FLAG))&&(e.contextStorage.setItem(e.COMMAND_EXECUTING_FLAG,!1),e.contextStorage.setItem(e.EXECUTING_IN_IFRAME_FLAG,!1),e._onReady(new cr({isCommandResult:!0})))});this.readyPromise=c.Promise.all([this.readyPromise,t])},Ua);function Ua(t,e){var n=La.call(this,t,{},{},e)||this;return n.lastParentDriverMessageId=null,n.parentDriverLink=new Aa(Ya.parent),n._initParentDriverListening(),n}var Ga={NodeSnapshot:_r,ElementSnapshot:br,SelectorExecutor:jo},Ha="%testCafeDriver%",Ba="%testCafeIframeDriver%",Va="%ScriptExecutionBarrier%",za="%testCafeEmbeddingUtils%",ja=o.nativeMethods,Xa=o.EVENTS.evalIframeScript;ja.objectDefineProperty(Ya,Ha,{configurable:!0,value:xa}),ja.objectDefineProperty(Ya,Ba,{configurable:!0,value:Oa}),ja.objectDefineProperty(Ya,Va,{configurable:!0,value:Eo}),ja.objectDefineProperty(Ya,za,{configurable:!0,value:Ga}),o.on(Xa,function(t){return qa(ja.contentWindowGetter.call(t.iframe))})}(Ya["%hammerhead%"],Ya["%hammerhead%"].Promise,Ya["%testCafeCore%"],Ya["%testCafeAutomation%"],Ya["%testCafeUI%"])}(window);